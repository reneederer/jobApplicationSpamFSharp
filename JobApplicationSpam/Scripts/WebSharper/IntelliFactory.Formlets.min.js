(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a=window;b=a.IntelliFactory=a.IntelliFactory||{};c=b.Formlets=b.Formlets||{};d=c.Base=c.Base||{};e=d.Tree=d.Tree||{};f=e.Tree=e.Tree||{};g=e.Edit=e.Edit||{};h=d.D=d.D||{};i=d.LayoutUtils=d.LayoutUtils||{};j=d.Result=d.Result||{};k=d.Form=d.Form||{};l=d.Formlet=d.Formlet||{};m=d.FormletProvider=d.FormletProvider||{};n=d.FormletBuilder=d.FormletBuilder||{};o=d.Validator=d.Validator||{};p=b&&b.Runtime;q=a.WebSharper;r=q&&q.Seq;s=q&&q.Enumerator;t=q&&q.List;u=q&&q.Util;v=q&&q.Unchecked;f=e.Tree=p.Class({Map:function(w){return this.$==1?new f({$:1,$0:w(this.$0)}):this.$==2?new f({$:2,$0:this.$0.Map(w),$1:this.$1.Map(w)}):f.Empty;},get_Sequence:function(){return this.$==1?[this.$0]:this.$==2?r.append(this.$0.get_Sequence(),this.$1.get_Sequence()):[];},GetEnumerator:function(){return s.Get(this.get_Sequence());},GetEnumerator0:function(){return s.Get(this.get_Sequence());}},null,f);f.Empty=new f({$:0});g=e.Edit=p.Class({get_Sequence:function(){return this.$==1?this.$0.get_Sequence():this.$==2?this.$0.get_Sequence():this.$0.get_Sequence();},GetEnumerator:function(){return s.Get(this.get_Sequence());},GetEnumerator0:function(){return s.Get(this.get_Sequence());}},null,g);e.DeepFlipEdit=function(w){return w.$==1?new g({$:2,$0:e.DeepFlipEdit(w.$0)}):w.$==2?new g({$:1,$0:e.DeepFlipEdit(w.$0)}):new g({$:0,$0:w.$0});};e.FlipEdit=function(w){return w.$==1?new g({$:2,$0:w.$0}):w.$==2?new g({$:1,$0:w.$0}):new g({$:0,$0:w.$0});};e.Delete=function(){return new g({$:0,$0:f.Empty});};e.Transform=function(w,x){return x.$==1?new g({$:1,$0:e.Transform(w,x.$0)}):x.$==2?new g({$:2,$0:e.Transform(w,x.$0)}):new g({$:0,$0:w(x.$0)});};e.Set=function(w){return new g({$:0,$0:new f({$:1,$0:w})});};e.Apply=function(w,x){function y(z,A){return z.$==1?A.$==2?new f({$:2,$0:y(z.$0,A.$0),$1:A.$1}):y(new g({$:1,$0:z.$0}),new f({$:2,$0:f.Empty,$1:A})):z.$==2?A.$==2?new f({$:2,$0:A.$0,$1:y(z.$0,A.$1)}):y(new g({$:2,$0:z.$0}),new f({$:2,$0:A,$1:f.Empty})):z.$0;}return y(w,x);};e.ReplacedTree=function(w,x){var y,z,A,B,C,D;while(true)if(w.$==1){y=w.$0;if(x.$==2){z=x.$0;w=y;x=z;}else{A=x;w=new g({$:1,$0:y});x=new f({$:2,$0:f.Empty,$1:A});}}else if(w.$==2){B=w.$0;if(x.$==2){C=x.$1;w=B;x=C;}else{D=x;w=new g({$:2,$0:B});x=new f({$:2,$0:D,$1:f.Empty});}}else return x;};e.FromSequence=function(w){function x(y,z){return new f({$:2,$0:y,$1:new f({$:1,$0:z})});}return(((p.Curried3(r.fold))(x))(f.Empty))(w);};e.Range=function(w,x){var y,z,A,B,C,D,E,F,G;y=w;z=x;A=0;while(true)if(y.$==1){B=y.$0;if(z.$==2){C=z.$0;y=B;z=C;}else{y=B;z=f.Empty;}}else if(y.$==2){D=y.$0;if(z.$==2){E=z.$1;F=z.$0;y=D;z=E;A=A+e.Count(F);}else{G=z;y=D;z=f.Empty;A=A+e.Count(G);}}else return[A,e.Count(z)];};e.Count=function(w){var x,y,z,A,B,C,D,E,F;x=0;y=t.T.Empty;z=w;while(true)if(z.$==2){A=z.$1;B=z.$0;y=new t.T({$:1,$0:A,$1:y});z=B;}else{C=z;D=C.$==0?0:1;if(y.$==1){E=y.$1;F=y.$0;x=x+D;y=E;z=F;}else return x+D;}};e.ShowEdit=function(w){function x(y){return y.$==1?"Left > "+x(y.$0):y.$==2?"Right > "+x(y.$0):"Replace";}return x(w);};h=d.D=p.Class({Dispose:a.ignore},q.Obj,h);h.New=p.Ctor(function(){},h);i=d.LayoutUtils=p.Class({New:function(w){return{Apply:function(x){var y,z;y=w();z=[f.Empty];return{$:1,$0:[y.Body,x.Subscribe(u.observer(function(A){var B,C;B=e.ReplacedTree(A,z[0]);z[0]=e.Apply(A,z[0]);C=(e.Range(A,z[0]))[0];y.Remove(B.get_Sequence());r.iteri(function(D,E){return(y.Insert(C+D))(E);},A);}))]};}};},Delay:function(w){return{Apply:function(x){return w().Apply(x);}};},Default:function(){return{Apply:function(){return null;}};}},q.Obj,i);i.New=p.Ctor(function(w){},i);j.Sequence=function(w){return r.fold(function(x,y){return x.$==1?y.$==1?{$:1,$0:t.append(x.$0,y.$0)}:{$:1,$0:x.$0}:y.$==1?{$:1,$0:y.$0}:{$:0,$0:t.append(x.$0,t.ofArray([y.$0]))};},{$:0,$0:t.T.Empty},w);};j.Map=function(w,x){return x.$==1?{$:1,$0:x.$0}:{$:0,$0:w(x.$0)};};j.OfOption=function(w){return w==null?{$:1,$0:t.T.Empty}:{$:0,$0:w.$0};};j.Apply=function(w,x){return w.$==1?x.$==1?{$:1,$0:t.append(w.$0,x.$0)}:{$:1,$0:w.$0}:x.$==1?{$:1,$0:x.$0}:{$:0,$0:w.$0(x.$0)};};j.Join=function(w){return w.$==1?{$:1,$0:w.$0}:w.$0;};k=d.Form=p.Class({Dispose:function(){this.Dispose$1();}},null,k);k.New=function(w,x,y,z){return new k({Body:w,Dispose:x,Notify:y,State:z});};l=d.Formlet=p.Class({MapResultI:function(w){var x;x=this;return l.New(this.Layout,function(){var y;y=x.Build();x.Utils.Reactive.Select(y.State,w);return k.New(y.Body,y.Dispose$1,y.Notify,y.State);},this.Utils);},BuildI:function(){return this.Build();},LayoutI:function(){return this.Layout;}},null,l);l.New=function(w,x,y){return new l({Layout:w,Build:x,Utils:y});};m=d.FormletProvider=p.Class({BindWith:function(w,x,y){var z;z=this;return z.New(function(){var A,B,C,D;A=z.Bind(x,y).BuildI();return k.New((B=z.U.DefaultLayout.Apply(z.U.Reactive.Where(A.Body,function(E){return E.$==1&&true;})),(C=z.U.DefaultLayout.Apply(z.U.Reactive.Where(A.Body,function(E){return E.$==2&&true;})),B!=null&&B.$==1&&(C!=null&&C.$==1&&(D=[B.$0[0],C.$0[0]],true))?z.U.Reactive.Return(e.Set(w(D[0],D[1]))):z.U.Reactive.Never())),A.Dispose$1,A.Notify,A.State);});},WithNotification:function(w,x){var y,z;y=this;z=y.New(function(){var A;A=y.BuildForm(x);return k.New(A.Body,A.Dispose$1,function(B){A.Notify(B);w(B);},A.State);});return y.WithLayout(x.LayoutI(),z);},LiftResult:function(w){return this.MapResult(function(x){return{$:0,$0:x};},w);},Sequence:function(w){var x,y,z;x=t.ofSeq(w);return x.$==1?(y=this.Return(function(A){return function(B){return new t.T({$:1,$0:A,$1:B});};}),(z=this.Sequence(x.$1),this.Apply(this.Apply(y,x.$0),z))):this.Return(t.T.Empty);},Delay:function(w){var x;x=this;return l.New(this.L.Delay(function(){return w().LayoutI();}),function(){return x.BuildForm(w());},this.U);},Bind:function(w,x){var y;y=this;return y.Join(y.Map(x,w));},WithCancelation:function(w,x){var y,z,A;function B(C,D){return D.$==0?{$:0,$0:null}:C.$==1?{$:1,$0:C.$0}:{$:0,$0:{$:1,$0:C.$0}};}y=this.Return(function(C){return function(D){return B(C,D);};});z=this.LiftResult(w);A=this.LiftResult(x);return this.MapResult(j.Join,this.Apply(this.Apply(y,z),A));},Deletable:function(w){var x;x=this;return this.Replace(w,function(y){return y!=null&&y.$==1?x.Return({$:1,$0:y.$0}):x.ReturnEmpty(null);});},Replace:function(w,x){var y;y=this;return y.Switch(y.Map(x,w));},WithNotificationChannel:function(w){var x,y;x=this;y=x.New(function(){var z;function A(B){return[B,z.Notify];}z=w.BuildI();return k.New(z.Body,z.Dispose$1,z.Notify,x.U.Reactive.Select(z.State,function(B){return j.Map(A,B);}));});return x.WithLayout(w.LayoutI(),y);},SelectMany:function(w){var x;x=this;return x.New(function(){var y,z,A;function B(){var C;function D(E){return new g({$:2,$0:E});}A[0]=(C=A[0],function(E){return D(C(E));});}y=x.BuildForm(w);z=x.U.Reactive.Heat(x.U.Reactive.Choose(y.State,function(C){return C.$==1?null:{$:1,$0:x.BuildForm(C.$0)};}));return k.New(x.U.Reactive.Merge(x.U.Reactive.Select(y.Body,function(C){return new g({$:1,$0:C});}),(A=[function(C){return new g({$:1,$0:C});}],x.U.Reactive.SelectMany(x.U.Reactive.Select(z,function(C){B();return x.U.Reactive.Select(C.Body,A[0]);})))),function(){y.Dispose$1();},function(C){y.Notify(C);},x.U.Reactive.Select(x.U.Reactive.CollectLatest(x.U.Reactive.Select(z,function(C){return C.State;})),j.Sequence));});},FlipBody:function(w){var x,y;x=this;y=x.New(function(){var z;z=w.BuildI();return k.New(x.U.Reactive.Select(z.Body,e.FlipEdit),z.Dispose$1,z.Notify,z.State);});return x.WithLayout(w.LayoutI(),y);},Switch:function(w){var x;x=this;return x.New(function(){var y,z;y=x.BuildForm(x.ApplyLayout(x.WithLayoutOrDefault(w)));z=x.U.Reactive.Heat(x.U.Reactive.Choose(y.State,function(A){return A.$==1?null:{$:1,$0:x.BuildForm(A.$0)};}));return k.New(x.U.Reactive.Concat(y.Body,x.U.Reactive.Switch(x.U.Reactive.Select(z,function(A){return A.Body;}))),function(){y.Dispose$1();},function(A){y.Notify(A);},x.U.Reactive.Switch(x.U.Reactive.Select(z,function(A){return A.State;})));});},Join:function(w){var x;x=this;return x.New(function(){var y,z,A;y=x.BuildForm(w);z=x.U.Reactive.Heat(x.U.Reactive.Select(y.State,function(B){return B.$==1?x.Fail(B.$0):x.BuildForm(B.$0);}));return k.New((A=x.U.Reactive.Select(x.U.Reactive.Switch(x.U.Reactive.Select(z,function(B){return x.U.Reactive.Concat(x.U.Reactive.Return(e.Delete()),B.Body);})),function(B){return new g({$:2,$0:B});}),x.U.Reactive.Merge(x.U.Reactive.Select(y.Body,function(B){return new g({$:1,$0:B});}),A)),function(){y.Dispose$1();},function(B){y.Notify(B);},x.U.Reactive.Switch(x.U.Reactive.Select(z,function(B){return B.State;})));});},EmptyForm:function(){return k.New(this.U.Reactive.Never(),a.ignore,a.ignore,this.U.Reactive.Never());},Empty:function(){var w;w=this;return w.New(function(){return k.New(w.U.Reactive.Return(e.Delete()),a.ignore,a.ignore,w.U.Reactive.Never());});},Never:function(){var w;w=this;return w.New(function(){return k.New(w.U.Reactive.Never(),a.ignore,a.ignore,w.U.Reactive.Never());});},ReturnEmpty:function(w){var x;x=this;return x.New(function(){return k.New(x.U.Reactive.Return(e.Delete()),a.ignore,a.ignore,x.U.Reactive.Return({$:0,$0:w}));});},FailWith:function(w){var x;x=this;return x.New(function(){return x.Fail(w);});},Fail:function(w){return k.New(this.U.Reactive.Never(),a.ignore,a.ignore,this.U.Reactive.Return({$:1,$0:w}));},Return:function(w){var x;x=this;return x.New(function(){return k.New(x.U.Reactive.Never(),a.ignore,a.ignore,x.U.Reactive.Return({$:0,$0:w}));});},Apply:function(w,x){var y;y=this;return y.New(function(){var z,A;function B(C,D){return j.Apply(D,C);}z=y.BuildForm(w);A=y.BuildForm(x);return k.New(y.U.Reactive.Merge(y.U.Reactive.Select(z.Body,function(C){return new g({$:1,$0:C});}),y.U.Reactive.Select(A.Body,function(C){return new g({$:2,$0:C});})),function(){A.Dispose$1();z.Dispose$1();},function(C){A.Notify(C);z.Notify(C);},y.U.Reactive.CombineLatest(A.State,z.State,function(C){return function(D){return B(C,D);};}));});},Map:function(w,x){return this.MapResult(function(y){return j.Map(w,y);},x);},MapResult:function(w,x){var y;y=this;return l.New(x.LayoutI(),function(){var z;z=x.BuildI();return k.New(z.Body,z.Dispose$1,z.Notify,y.U.Reactive.Select(z.State,w));},this.U);},WithLayoutOrDefault:function(w){return this.MapBody(a.id,w);},MapBody:function(w,x){var y;y=this;return this.WithLayout({Apply:function(z){var A,B;A=x.LayoutI().Apply(z);return A==null?(B=y.U.DefaultLayout.Apply(z),B==null?null:{$:1,$0:[w(B.$0[0]),B.$0[1]]}):{$:1,$0:[w(A.$0[0]),A.$0[1]]};}},x);},AppendLayout:function(w,x){return this.WithLayout(w,this.ApplyLayout(x));},ApplyLayout:function(w){var x;x=this;return x.New(function(){var y,z;y=w.BuildI();return k.New((z=w.LayoutI().Apply(y.Body),z==null?y.Body:x.U.Reactive.Return(e.Set(z.$0[0]))),y.Dispose$1,y.Notify,y.State);});},InitWithFailure:function(w){var x,y;x=this;y=x.New(function(){var z;z=w.BuildI();return k.New(z.Body,z.Dispose$1,z.Notify,x.U.Reactive.Concat(x.U.Reactive.Return({$:1,$0:t.T.Empty}),z.State));});return x.WithLayout(w.LayoutI(),y);},ReplaceFirstWithFailure:function(w){var x,y;x=this;y=x.New(function(){var z,A;z=w.BuildI();return k.New(z.Body,z.Dispose$1,z.Notify,(A=x.U.Reactive.Drop(z.State,1),x.U.Reactive.Concat(x.U.Reactive.Return({$:1,$0:t.T.Empty}),A)));});return x.WithLayout(w.LayoutI(),y);},InitWith:function(w,x){var y,z;y=this;z=y.New(function(){var A;A=x.BuildI();return k.New(A.Body,A.Dispose$1,A.Notify,y.U.Reactive.Concat(y.U.Reactive.Return({$:0,$0:w}),A.State));});return y.WithLayout(x.LayoutI(),z);},WithLayout:function(w,x){return l.New(w,function(){return x.BuildI();},this.U);},FromState:function(w){var x;x=this;return x.New(function(){return k.New(x.U.Reactive.Never(),a.ignore,a.ignore,w);});},New:function(w){return l.New(this.L.Default(),w,this.U);},BuildForm:function(w){var x,y,z;x=w.BuildI();y=w.LayoutI().Apply(x.Body);return y!=null&&y.$==1?(z=y.$0[1],k.New(this.U.Reactive.Return(e.Set(y.$0[0])),function(){x.Dispose$1();z.Dispose();},x.Notify,x.State)):x;}},q.Obj,m);m.New=p.Ctor(function(w){this.U=w;this.L=new i.New({Reactive:this.U.Reactive});},m);n=d.FormletBuilder=p.Class({ReturnFrom:a.id,Delay:function(w){return this.F.Delay(w);},Bind:function(w,x){return this.F.Bind(w,x);},Return:function(w){return this.F.Return(w);}},q.Obj,n);n.New=p.Ctor(function(w){this.F=w;},n);o=d.Validator=p.Class({IsNotEqual:function(w,x,y){return this.Validate(function(z){return!v.Equals(z,w);},x,y);},IsEqual:function(w,x,y){return this.Validate(function(z){return v.Equals(z,w);},x,y);},IsLessThan:function(w,x,y){return this.Validate(function(z){return v.Compare(z,w)===-1;},x,y);},IsGreaterThan:function(w,x,y){return this.Validate(function(z){return v.Compare(z,w)===1;},x,y);},IsTrue:function(w,x){return this.Validate(a.id,w,x);},IsFloat:function(w){var x;x=this;return function(y){return x.IsRegexMatch("^\\s*(\\+|-)?((\\d+(\\.\\d+)?)|(\\.\\d+))\\s*$",w,y);};},IsInt:function(w){var x;x=this;return function(y){return x.IsRegexMatch("^-?\\d+$",w,y);};},IsEmail:function(w){var x;x=this;return function(y){return x.IsRegexMatch("^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?\\.)+[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?$",w,y);};},IsRegexMatch:function(w,x,y){var z;z=this;return this.Validate(function(A){return z.VP.Matches(w,A);},x,y);},IsNotEmpty:function(w,x){return this.Validate(function(y){return y!=="";},w,x);},Is:function(w,x,y){return this.Validate(w,x,y);},Validate:function(w,x,y){return y.MapResultI(function(z){var A;return z.$==1?{$:1,$0:z.$0}:(A=z.$0,w(A)?{$:0,$0:A}:{$:1,$0:t.ofArray([x])});});}},q.Obj,o);o.New=p.Ctor(function(w){this.VP=w;},o);}());
