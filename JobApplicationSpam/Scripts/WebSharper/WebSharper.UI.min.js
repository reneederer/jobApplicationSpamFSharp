(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.Abbrev=c.Abbrev||{};g=f.Fresh=f.Fresh||{};h=f.HashSet=f.HashSet||{};i=f.Dict=f.Dict||{};j=b&&b.Obj;k=f.Slot=f.Slot||{};l=f.Async=f.Async||{};m=f.Mailbox=f.Mailbox||{};n=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};o=c.AppendList=c.AppendList||{};p=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};q=c.DomUtility=c.DomUtility||{};r=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};s=c.Trie=c.Trie||{};t=s.LookupResult=s.LookupResult||{};u=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};v=c.Snap=c.Snap||{};w=c.Var=c.Var||{};x=c.View=c.View||{};y=c.ConcreteVar=c.ConcreteVar||{};z=c.Updates=c.Updates||{};A=c.ViewBuilder=c.ViewBuilder||{};B=c.Submitter=c.Submitter||{};C=c.Key=c.Key||{};D=c.Model=c.Model||{};E=c.Serializer=c.Serializer||{};F=c.Storage=c.Storage||{};G=F.ArrayStorage=F.ArrayStorage||{};H=F.LocalStorageBackend=F.LocalStorageBackend||{};I=c.ListModel=c.ListModel||{};J=c.ListModels=c.ListModels||{};K=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};L=c.ReactiveExtensions=c.ReactiveExtensions||{};M=c.DoubleInterpolation=c.DoubleInterpolation||{};N=c.Interpolation=c.Interpolation||{};O=c.Easing=c.Easing||{};P=c.Easings=c.Easings||{};Q=c.An=c.An||{};R=c.Anims=c.Anims||{};S=c.Trans=c.Trans||{};T=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};U=c.AnimatedAttrNode=c.AnimatedAttrNode||{};V=c.DynamicAttrNode=c.DynamicAttrNode||{};W=c.AttrProxy=c.AttrProxy||{};X=c.Client=c.Client||{};Y=X.Attrs=X.Attrs||{};Z=Y.Dyn=Y.Dyn||{};_0=c.Attrs=c.Attrs||{};_1=c.CheckedInput=c.CheckedInput||{};_2=c.AttrModule=c.AttrModule||{};_3=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};_4=c.DocElemNode=c.DocElemNode||{};_5=X.Docs=X.Docs||{};_6=_5.DomNodes=_5.DomNodes||{};_7=_5.NodeSet=_5.NodeSet||{};_8=_5.RunState=_5.RunState||{};_9=c.Docs=c.Docs||{};_=c.Doc=c.Doc||{};$=c.Elt=c.Elt||{};ba=X.EltUpdater=X.EltUpdater||{};bb=a.StartupCode$WebSharper_UI$Doc_Client=a.StartupCode$WebSharper_UI$Doc_Client||{};bc=c.Flow=c.Flow||{};bd=c.FlowBuilder=c.FlowBuilder||{};be=c.HtmlModule=c.HtmlModule||{};bf=be.attr=be.attr||{};bg=c.Router=c.Router||{};bh=c.Route=c.Route||{};bi=c.Routing=c.Routing||{};bj=c.RouteMap=c.RouteMap||{};bk=c.Input=c.Input||{};bl=bk.MousePosSt=bk.MousePosSt||{};bm=bk.MouseBtnSt=bk.MouseBtnSt||{};bn=bk.Mouse=bk.Mouse||{};bo=bk.KeyListenerSt=bk.KeyListenerSt||{};bp=bk.Keyboard=bk.Keyboard||{};bq=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};br=b&&b.List;bs=b&&b.Arrays;bt=b&&b.Enumerator;bu=b&&b.Strings;bv=b&&b.Char;bw=b&&b.Collections;bx=bw&&bw.HashSet;by=b&&b.Seq;bz=a.IntelliFactory;bA=bz&&bz.Runtime;bB=b&&b.Unchecked;bC=a.console;bD=b&&b.Concurrency;bE=bw&&bw.Map;bF=bw&&bw.FSharpMap;bG=b&&b.Operators;bH=b&&b.Queue;bI=b&&b.Lazy;bJ=bw&&bw.Dictionary;bK=a.JSON;bL=b&&b.Numeric;bM=a.Node;bN=a.jQuery;bO=b&&b.Slice;bP=b&&b.Sitelets;bQ=bP&&bP.RouterModule;bR=bP&&bP.Route;bS=b&&b.Utils;d.mapInPlace=function(bT,bU){var bV,bW;for(bV=0,bW=bU.length-1;bV<=bW;bV++)bU[bV]=bT(bU[bV]);return bU;};d.ofSeqNonCopying=function(bT){var bU,bV;if(bT instanceof a.Array)return bT;else if(bT instanceof br.T)return bs.ofList(bT);else if(bT===null)return[];else{bU=[];bV=bt.Get(bT);try{while(bV.MoveNext())bU.push(bV.Current());return bU;}finally{if("Dispose"in bV)bV.Dispose();}}};d.MapTreeReduce=function(bT,bU,bV,bW){var bX;function bY(bZ,b0){var b1,b2;return b0<=0?bU:b0===1&&(bZ>=0&&bZ<bX&&true)?bT(bs.get(bW,bZ)):(b2=b0/2>>0,bV(bY(bZ,b2),bY(bZ+b2,b0-b2)));}bX=bs.length(bW);return bY(0,bX);};d.TreeReduce=function(bT,bU,bV){var bW;function bX(bY,bZ){var b0,b1;return bZ<=0?bT:bZ===1&&(bY>=0&&bY<bW&&true)?bs.get(bV,bY):(b1=bZ/2>>0,bU(bX(bY,b1),bX(bY+b1,bZ-b1)));}bW=bs.length(bV);return bX(0,bW);};e.isBlank=function(bT){return bu.forall(bv.IsWhiteSpace,bT);};g.Id=function(){g.set_counter(g.counter()+1);return"uid"+a.String(g.counter());};g.Int=function(){g.set_counter(g.counter()+1);return g.counter();};g.counter=function(){n.$cctor();return n.counter;};g.set_counter=function(bT){n.$cctor();n.counter=bT;};h.Filter=function(bT,bU){return new bx.New$2(bs.filter(bT,h.ToArray(bU)));};h.Intersect=function(bT,bU){var bV;bV=new bx.New$2(h.ToArray(bT));bV.IntersectWith(h.ToArray(bU));return bV;};h.Except=function(bT,bU){var bV;bV=new bx.New$2(h.ToArray(bU));bV.ExceptWith(h.ToArray(bT));return bV;};h.ToArray=function(bT){var bU;bU=bs.create(bT.get_Count(),void 0);bT.CopyTo(bU);return bU;};i.ToValueArray=function(bT){var bU;bU=bs.create(bT.count,void 0);by.iteri(function(bV,bW){return bs.set(bU,bV,bW.V);},bT);return bU;};i.ToKeyArray=function(bT){var bU;bU=bs.create(bT.count,void 0);by.iteri(function(bV,bW){return bs.set(bU,bV,bW.K);},bT);return bU;};k=f.Slot=bA.Class({GetHashCode:function(){return bB.Hash(this.key(this.value));},Equals:function(bT){return bB.Equals(this.key(this.value),this.key(bT.get_Value()));},get_Value:function(){return this.value;}},j,k);k.New=bA.Ctor(function(bT,bU){this.key=bT;this.value=bU;},k);k.Create=function(bT,bU){return new k.New(bT,bU);};l.OnError=function(bT){return bC.log("WebSharper UI: Uncaught asynchronous exception",bT);};l.StartTo=function(bT,bU){bD.StartWithContinuations(bT,bU,function(bV){l.OnError(bV);},a.ignore,null);};m.StartProcessor=function(bT){var bU;function bV(){var bW;bW=null;return bD.Delay(function(){return bD.Bind(bT,function(){var bX;bX=bU[0];return bX===1?(bU[0]=0,bD.Zero()):bX===2?(bU[0]=1,bV()):bD.Zero();});});}bU=[0];return function(){var bW;bW=bU[0];bW===0?(bU[0]=1,bD.Start(bV(),null)):bW===1?bU[0]=2:void 0;};};n.$cctor=function(){n.$cctor=a.ignore;n.counter=0;};o.FromArray=function(bT){var bU;bU=bT.length;return bU===0?{$:0}:bU===1?{$:1,$0:bs.get(bT,0)}:{$:3,$0:bT.slice()};};o.ToArray=function(bT){var bU;function bV(bW){if(bW.$==1)bU.push(bW.$0);else if(bW.$==2){bV(bW.$0);bV(bW.$1);}else if(bW.$==3)bs.iter(function(bX){bU.push(bX);},bW.$0);}bU=[];bV(bT);return bU.slice(0);};o.Single=function(bT){return{$:1,$0:bT};};o.Concat=function(bT){var bU;bU=d.ofSeqNonCopying(bT);return d.TreeReduce(o.Empty(),o.Append,bU);};o.Append=function(bT,bU){return bT.$==0?bU:bU.$==0?bT:{$:2,$0:bT,$1:bU};};o.Empty=function(){p.$cctor();return p.Empty;};p.$cctor=function(){p.$cctor=a.ignore;p.Empty={$:0};};q.SetProperty=function(bT,bU,bV){return bT.setProperty(bU,bV);};q.IterSelector=function(bT,bU,bV){var bW,bX,bY;bW=bT.querySelectorAll(bU);for(bX=0,bY=bW.length-1;bX<=bY;bX++)bV(bW[bX]);};q.ChildrenArray=function(bT){var bU,bV,bW;bU=[];for(bV=0,bW=bT.childNodes.length-1;bV<=bW;bV++)bU.push(bT.childNodes[bV]);return bU;};q.RemoveClass=function(bT,bU){a.jQuery(bT).removeClass(bU);};q.AddClass=function(bT,bU){a.jQuery(bT).addClass(bU);};q.InsertAt=function(bT,bU,bV){var bW;if(!(bV.parentNode===bT&&bU===(bW=bV.nextSibling,bB.Equals(bW,null)?null:bW)))bT.insertBefore(bV,bU);};q.RemoveNode=function(bT,bU){if(bU.parentNode===bT)bT.removeChild(bU);};q.SetStyle=function(bT,bU,bV){q.SetProperty(bT.style,bU,bV);};q.SetAttr=function(bT,bU,bV){bT.setAttribute(bU,bV);};q.RemoveAttr=function(bT,bU){bT.removeAttribute(bU);};q.CreateAttr=function(bT,bU){var bV;bV=q.Doc().createAttribute(bT);bV.value=bU;return bV;};q.CreateText=function(bT){return q.Doc().createTextNode(bT);};q.CreateSvgElement=function(bT){return q.Doc().createElementNS("http://www.w3.org/2000/svg",bT);};q.CreateElement=function(bT){return q.Doc().createElement(bT);};q.Clear=function(bT){while(bT.hasChildNodes())bT.removeChild(bT.firstChild);};q.ClearAttrs=function(bT){while(bT.hasAttributes())bT.removeAttributeNode(bT.attributes.item(0));};q.AppendTo=function(bT,bU){bT.appendChild(bU);};q.Doc=function(){r.$cctor();return r.Doc;};r.$cctor=function(){r.$cctor=a.ignore;r.Doc=a.document;};t.NotFound={$:1};s.Empty=function(){u.$cctor();return u.Empty;};s.Lookup=function(bT,bU){return s.Look(br.ofSeq(bU),bT);};s.Look=function(bT,bU){var bV,bW;switch(bU.$==2?(bV=bU.$0,0):bU.$==0?bT.$==1?(bV=[bT.$0,bT.$1,bU.$0],1):2:2){case 0:return{$:0,$0:bV,$1:bT};break;case 1:bW=bE.TryFind(bV[0],bV[2]);return bW==null?t.NotFound:s.Look(bV[1],bW.$0);break;case 2:return t.NotFound;break;}};s.ToArray=function(bT){var bU;bU=[];s.Map(function(){return function(bV){return bU.push(bV);};},bT);return bU.slice(0);};s.Mapi=function(bT,bU){var bV;function bW(){var bX;bX=bV[0];bV[0]=bX+1;return bX;}bV=[0];return s.Map(function(bX){return bT(bW(),bX);},bU);};s.Map=function(bT,bU){return s.MapLoop(br.T.Empty,bT,bU);};s.MapLoop=function(bT,bU,bV){return bV.$==1?{$:1}:bV.$==2?{$:2,$0:(bU(bT))(bV.$0)}:s.TrieBranch(bE.Map(function(bW,bX){return s.MapLoop(br.append(bT,br.ofArray([bW])),bU,bX);},bV.$0));};s.Merge=function(bT){var bU,bV,bW;bU=d.ofSeqNonCopying(bT);bV=bs.length(bU);return bV===0?{$:1,$0:{$:1}}:bV===1?{$:1,$0:bs.get(bU,0)}:bs.exists(s.IsLeaf,bU)?null:(bW=s.MergeMaps(s.Merge,by.choose(function(bX){return bX.$==0?{$:1,$0:bX.$0}:null;},bU)),bW==null?null:{$:1,$0:s.TrieBranch(bW.$0)});};s.IsLeaf=function(bT){return bT.$==2&&true;};s.MergeMaps=function(bT,bU){var bV,bW;function bX(bY,bZ){var b0;b0=bT(bZ);return b0==null?null:{$:1,$0:[bY,b0.$0]};}bV=s.AllSome(by.map(function(bY){return bX(bY[0],bY[1]);},bE.ToSeq((bW=by.collect(bE.ToSeq,bU),by.fold(function(bY,bZ){return s.MultiAdd(bZ[0],bZ[1],bY);},new bF.New([]),bW)))));return bV==null?null:{$:1,$0:bE.OfArray(bs.ofSeq(bV.$0))};};s.AllSome=function(bT){var bU,bV,bW,bX;bV=bt.Get(bT);bW=[];bU=true;while(bU&&bV.MoveNext()){bX=bV.Current();bX!=null&&bX.$==1?bW.push(bX.$0):bU=false;}return bU?{$:1,$0:bW.slice()}:null;};s.MultiAdd=function(bT,bU,bV){return bV.Add(bT,new br.T({$:1,$0:bU,$1:s.MultiFind(bT,bV)}));};s.MultiFind=function(bT,bU){var bV;bV=bE.TryFind(bT,bU);return bV==null?br.T.Empty:bV.$0;};s.Prefix=function(bT,bU){return s.TrieBranch(new bF.New(br.ofArray([[bT,bU]])));};s.Leaf=function(bT){return{$:2,$0:bT};};s.TrieBranch=function(bT){return bT.get_IsEmpty()?{$:1}:{$:0,$0:bT};};u.$cctor=function(){u.$cctor=a.ignore;u.Empty={$:1};};v.Obsolete=function(bT){var bU,bV,bW,bX,bY;bV=bT.s;if(bV==null||(bV!=null&&bV.$==2?(bU=bV.$1,false):bV!=null&&bV.$==3?(bU=bV.$1,false):true))void 0;else{bT.s=null;for(bW=0,bX=bs.length(bU)-1;bW<=bX;bW++){bY=bs.get(bU,bW);typeof bY=="object"?function(bZ){v.Obsolete(bZ);}(bY):bY();}}};v.New=function(bT){return{s:bT};};v.MapAsync=function(bT,bU){var bV;bV=v.New({$:3,$0:[],$1:[]});v.When(bU,function(bW){l.StartTo(bT(bW),function(bX){v.MarkDone(bV,bU,bX);});},bV);return bV;};v.SnapshotOn=function(bT,bU){var bV;function bW(bX){var bY,bZ,b0;if(!(bY=bV.s,bY!=null&&bY.$==0||bY!=null&&bY.$==2&&true)){bZ=v.ValueAndForever(bT);b0=v.ValueAndForever(bU);bZ!=null&&bZ.$==1?b0!=null&&b0.$==1?bZ.$0[1]||b0.$0[1]?v.MarkForever(bV,b0.$0[0]):v.MarkReady(bV,b0.$0[0]):void 0:void 0;}}bV=v.New({$:3,$0:[],$1:[]});v.When(bT,bW,bV);v.WhenReady(bU,bW);return bV;};v.Map3=function(bT,bU,bV,bW){var bX,bY,bZ,b0;function b1(b2){var b3,b4,b5,b6;if(!(b3=b0.s,b3!=null&&b3.$==0||b3!=null&&b3.$==2&&true)){b4=v.ValueAndForever(bU);b5=v.ValueAndForever(bV);b6=v.ValueAndForever(bW);b4!=null&&b4.$==1?b5!=null&&b5.$==1?b6!=null&&b6.$==1?b4.$0[1]&&b5.$0[1]&&b6.$0[1]?v.MarkForever(b0,bT(b4.$0[0],b5.$0[0],b6.$0[0])):v.MarkReady(b0,bT(b4.$0[0],b5.$0[0],b6.$0[0])):void 0:void 0:void 0;}}bX=bU.s;bY=bV.s;bZ=bW.s;return bX!=null&&bX.$==0?bY!=null&&bY.$==0?bZ!=null&&bZ.$==0?v.New({$:0,$0:bT(bX.$0,bY.$0,bZ.$0)}):v.Map3Opt1(bT,bX.$0,bY.$0,bW):bZ!=null&&bZ.$==0?v.Map3Opt2(bT,bX.$0,bZ.$0,bV):v.Map3Opt3(bT,bX.$0,bV,bW):bY!=null&&bY.$==0?bZ!=null&&bZ.$==0?v.Map3Opt4(bT,bY.$0,bZ.$0,bU):v.Map3Opt5(bT,bY.$0,bU,bW):bZ!=null&&bZ.$==0?v.Map3Opt6(bT,bZ.$0,bU,bV):(b0=v.New({$:3,$0:[],$1:[]}),(v.When(bU,b1,b0),v.When(bV,b1,b0),v.When(bW,b1,b0),b0));};v.Map3Opt6=function(bT,bU,bV,bW){return v.Map2(function(bX,bY){return bT(bX,bY,bU);},bV,bW);};v.Map3Opt5=function(bT,bU,bV,bW){return v.Map2(function(bX,bY){return bT(bX,bU,bY);},bV,bW);};v.Map3Opt4=function(bT,bU,bV,bW){return v.Map(function(bX){return bT(bX,bU,bV);},bW);};v.Map3Opt3=function(bT,bU,bV,bW){return v.Map2(function(bX,bY){return bT(bU,bX,bY);},bV,bW);};v.Map3Opt2=function(bT,bU,bV,bW){return v.Map(function(bX){return bT(bU,bX,bV);},bW);};v.Map3Opt1=function(bT,bU,bV,bW){return v.Map(function(bX){return bT(bU,bV,bX);},bW);};v.Map2Unit=function(bT,bU){var bV,bW,bX;function bY(){var bZ,b0,b1;if(!(bZ=bX.s,bZ!=null&&bZ.$==0||bZ!=null&&bZ.$==2&&true)){b0=v.ValueAndForever(bT);b1=v.ValueAndForever(bU);b0!=null&&b0.$==1?b1!=null&&b1.$==1?b0.$0[1]&&b1.$0[1]?v.MarkForever(bX,null):v.MarkReady(bX,null):void 0:void 0;}}bV=bT.s;bW=bU.s;return bV!=null&&bV.$==0?bW!=null&&bW.$==0?v.New({$:0,$0:null}):bU:bW!=null&&bW.$==0?bT:(bX=v.New({$:3,$0:[],$1:[]}),(v.When(bT,bY,bX),v.When(bU,bY,bX),bX));};v.Map2=function(bT,bU,bV){var bW,bX,bY;function bZ(b0){var b1,b2,b3;if(!(b1=bY.s,b1!=null&&b1.$==0||b1!=null&&b1.$==2&&true)){b2=v.ValueAndForever(bU);b3=v.ValueAndForever(bV);b2!=null&&b2.$==1?b3!=null&&b3.$==1?b2.$0[1]&&b3.$0[1]?v.MarkForever(bY,bT(b2.$0[0],b3.$0[0])):v.MarkReady(bY,bT(b2.$0[0],b3.$0[0])):void 0:void 0;}}bW=bU.s;bX=bV.s;return bW!=null&&bW.$==0?bX!=null&&bX.$==0?v.New({$:0,$0:bT(bW.$0,bX.$0)}):v.Map2Opt1(bT,bW.$0,bV):bX!=null&&bX.$==0?v.Map2Opt2(bT,bX.$0,bU):(bY=v.New({$:3,$0:[],$1:[]}),(v.When(bU,bZ,bY),v.When(bV,bZ,bY),bY));};v.Map2Opt2=function(bT,bU,bV){return v.Map(function(bW){return bT(bW,bU);},bV);};v.Map2Opt1=function(bT,bU,bV){return v.Map(function(bW){return bT(bU,bW);},bV);};v.MapCachedBy=function(bT,bU,bV,bW){return v.Map(function(bX){var bY,bZ,b0;bY=bU[0];return bY!=null&&bY.$==1&&(bT(bX,bY.$0[0])&&(bZ=[bY.$0[0],bY.$0[1]],true))?bZ[1]:(b0=bV(bX),(bU[0]={$:1,$0:[bX,b0]},b0));},bW);};v.Copy=function(bT){var bU,bV,bW;bU=bT.s;return bU==null?bT:bU!=null&&bU.$==2?(bV=v.New({$:2,$0:bU.$0,$1:[]}),(v.WhenObsolete(bT,bV),bV)):bU!=null&&bU.$==3?(bW=v.New({$:3,$0:[],$1:[]}),(v.When(bT,function(bX){v.MarkDone(bW,bT,bX);},bW),bW)):bT;};v.Map=function(bT,bU){var bV,bW;bV=bU.s;return bV!=null&&bV.$==0?v.New({$:0,$0:bT(bV.$0)}):(bW=v.New({$:3,$0:[],$1:[]}),(v.When(bU,function(bX){v.MarkDone(bW,bU,bT(bX));},bW),bW));};v.Sequence=function(bT){var bU,bV,bW;function bX(bY){var bZ;if(bW[0]===0){bZ=bs.map(function(b0){var b1;b1=b0.s;return b1!=null&&b1.$==0?b1.$0:b1!=null&&b1.$==2?b1.$0:bG.FailWith("value not found by View.Sequence");},bU);bs.forall(function(b0){var b1;return(b1=b0.s,b1!=null&&b1.$==0)&&true;},bU)?v.MarkForever(bV,bZ):v.MarkReady(bV,bZ);}else bW[0]--;}bU=bs.ofSeq(bT);return bU.length==0?v.New({$:0,$0:[]}):(bV=v.New({$:3,$0:[],$1:[]}),(bW=[bs.length(bU)-1],(bs.iter(function(bY){v.When(bY,bX,bV);},bU),bV)));};v.CreateForeverAsync=function(bT){var bU;bU=v.New({$:3,$0:[],$1:[]});l.StartTo(bT,function(bV){v.MarkForever(bU,bV);});return bU;};v.JoinInner=function(bT){var bU;bU=v.New({$:3,$0:[],$1:[]});v.When(bT,function(bV){var bW;bW=bV();v.When(bW,function(bX){var bY,bZ;if((bY=bW.s,bY!=null&&bY.$==0)&&true&&((bZ=bT.s,bZ!=null&&bZ.$==0)&&true))v.MarkForever(bU,bX);else v.MarkReady(bU,bX);},bU);v.WhenObsolete(bT,bW);},bU);return bU;};v.Join=function(bT){var bU;bU=v.New({$:3,$0:[],$1:[]});v.When(bT,function(bV){var bW;bW=bV();v.When(bW,function(bX){var bY,bZ;if((bY=bW.s,bY!=null&&bY.$==0)&&true&&((bZ=bT.s,bZ!=null&&bZ.$==0)&&true))v.MarkForever(bU,bX);else v.MarkReady(bU,bX);},bU);},bU);return bU;};v.ValueAndForever=function(bT){var bU;bU=bT.s;return bU!=null&&bU.$==0?{$:1,$0:[bU.$0,true]}:bU!=null&&bU.$==2?{$:1,$0:[bU.$0,false]}:null;};v.WhenObsoleteRun=function(bT,bU){var bV;bV=bT.s;bV==null?bU():bV!=null&&bV.$==2?bV.$1.push(bU):bV!=null&&bV.$==3?bV.$1.push(bU):void 0;};v.WhenObsolete=function(bT,bU){var bV;bV=bT.s;bV==null?v.Obsolete(bU):bV!=null&&bV.$==2?v.EnqueueSafe(bV.$1,bU):bV!=null&&bV.$==3?v.EnqueueSafe(bV.$1,bU):void 0;};v.WhenReady=function(bT,bU){var bV,bW;bW=bT.s;switch(bW!=null&&bW.$==2?(bV=bW.$0,0):bW==null?1:bW!=null&&bW.$==3?2:(bV=bW.$0,0)){case 0:bU(bV);break;case 1:null;break;case 2:bW.$0.push(bU);break;}};v.WhenRun=function(bT,bU,bV){var bW;bW=bT.s;bW==null?bV():bW!=null&&bW.$==2?(bW.$1.push(bV),bU(bW.$0)):bW!=null&&bW.$==3?(bW.$0.push(bU),bW.$1.push(bV)):bU(bW.$0);};v.When=function(bT,bU,bV){var bW;bW=bT.s;bW==null?v.Obsolete(bV):bW!=null&&bW.$==2?(v.EnqueueSafe(bW.$1,bV),bU(bW.$0)):bW!=null&&bW.$==3?(bW.$0.push(bU),v.EnqueueSafe(bW.$1,bV)):bU(bW.$0);};v.EnqueueSafe=function(bT,bU){var bV,bW,bX,bY;bT.push(bU);if(bT.length%20===0){bV=bT.slice(0);bH.Clear(bT);for(bW=0,bX=bs.length(bV)-1;bW<=bX;bW++){bY=bs.get(bV,bW);typeof bY=="object"?function(bZ){if(bZ.s)bT.push(bZ);}(bY):function(bZ){bT.push(bZ);}(bY);}}else void 0;};v.MarkDone=function(bT,bU,bV){var bW;if((bW=bU.s,bW!=null&&bW.$==0)&&true)v.MarkForever(bT,bV);else v.MarkReady(bT,bV);};v.MarkReady=function(bT,bU){var bV,bW,bX,bY;bV=bT.s;if(bV!=null&&bV.$==3){bT.s={$:2,$0:bU,$1:bV.$1};bW=bV.$0;for(bX=0,bY=bs.length(bW)-1;bX<=bY;bX++)(bs.get(bW,bX))(bU);}else void 0;};v.MarkForever=function(bT,bU){var bV,bW,bX,bY;bV=bT.s;if(bV!=null&&bV.$==3){bT.s={$:0,$0:bU};bW=bV.$0;for(bX=0,bY=bs.length(bW)-1;bX<=bY;bX++)(bs.get(bW,bX))(bU);}else void 0;};w=c.Var=bA.Class({},j,w);w.New=bA.Ctor(function(){},w);x=c.View=bA.Class({get_V:function(){return bG.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,x);y=c.ConcreteVar=bA.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(bT){var bU;bU=bT(this.Get());bU!=null&&bU.$==1?this.Set(bU.$0):void 0;},Update:function(bT){this.Set(bT(this.Get()));},SetFinal:function(bT){if(this.isConst)(function(bU){return bU("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bU){bC.log(bU);}));else{v.Obsolete(this.snap);this.isConst=true;this.current=bT;this.snap=v.New({$:0,$0:bT});}},Set:function(bT){if(this.isConst)(function(bU){return bU("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bU){bC.log(bU);}));else{v.Obsolete(this.snap);this.current=bT;this.snap=v.New({$:2,$0:bT,$1:[]});}},Get:function(){return this.current;}},w,y);y.New=bA.Ctor(function(bT,bU,bV){var bW;bW=this;w.New.call(this);this.isConst=bT;this.current=bV;this.snap=bU;this.view=function(){return bW.snap;};this.id=g.Int();},y);w.Lens=function(bT,bU,bV){var bW,bX,bY;bW=g.Id();bX=x.Map(bU,bT.get_View());bY=new w({Get:function(){return bU(bT.Get());},Set:function(bZ){return bT.Update(function(b0){return bV(b0,bZ);});},SetFinal:function(bZ){return this.Set(bZ);},Update:function(bZ){return bT.Update(function(b0){return bV(b0,bZ(bU(b0)));});},UpdateMaybe:function(bZ){return bT.UpdateMaybe(function(b0){var b1;b1=bZ(bU(b0));return b1==null?null:{$:1,$0:bV(b0,b1.$0)};});},get_View:function(){return bX;},get_Id:function(){return bW;}});w.New.call(bY);return bY;};w.Update=function(bT,bU){w.Set(bT,bU(bT.Get()));};w.SetFinal=function(bT,bU){bT.SetFinal(bU);};w.Set=function(bT,bU){bT.Set(bU);};w.CreateWaiting=function(){return new y.New(false,v.New({$:3,$0:[],$1:[]}),null);};w.Create=function(){return new y.New(false,v.New({$:2,$0:null,$1:[]}),null);};w.CreateLogged=function(bT,bU){var bV;!window.UINVars?window.UINVars=[]:void 0;bV=w.Create$1(bU);window.UINVars.push([bT,bV]);return bV;};w.Create$1=function(bT){return new y.New(false,v.New({$:2,$0:bT,$1:[]}),bT);};z=c.Updates=bA.Class({set_Value:function(bT){var bU;bU=this.s;!(bU===null)?v.Obsolete(bU):void 0;this.c=bT;}},null,z);z.Create=function(bT){var bU;bU=null;bU=z.New(bT,null,function(){var bV;bV=bU.s;return bV===null?(bV=v.Copy(bU.c()),bU.s=bV,v.WhenObsoleteRun(bV,function(){bU.s=null;}),bV):bV;});return bU;};z.New=function(bT,bU,bV){return new z({c:bT,s:bU,v:bV});};x.get_Do=function(){return A.B;};x.Apply=function(bT,bU){return x.Map2(function(bV,bW){return bV(bW);},bT,bU);};x.AsyncAwait=function(bT,bU){function bV(bW){var bX,bY;function bZ(){return x.RemovableSink(function(b0){if(bT(b0)){(bI.Force(bX))();bW(b0);}},bU);}bX=bI.Create(bZ);bY=bI.Force(bX);}return bD.FromContinuations(function(bW,bX,bY){return bV.apply(null,[bW,bX,bY]);});};x.RemovableSink=function(bT,bU){var bV;function bW(){v.WhenRun(bU(),function(bX){if(bV[0])bT(bX);},function(){if(bV[0])bD.scheduler().Fork(bW);});}bV=[true];bD.scheduler().Fork(bW);return function(){bV[0]=false;};};x.Sink=function(bT,bU){function bV(){v.WhenRun(bU(),bT,function(){bD.scheduler().Fork(bV);});}bD.scheduler().Fork(bV);};x.TryFinally=function(bT,bU){return x.CreateLazy(function(){try{return bU();}finally{bT();}});};x.TryWith=function(bT,bU){return x.CreateLazy(function(){try{return bU();}catch(bV){return(bT(bV))();}});};x.ConstAsync=function(bT){var bU;bU=v.CreateForeverAsync(bT);return function(){return bU;};};x.Const=function(bT){var bU;bU=v.New({$:0,$0:bT});return function(){return bU;};};x.Sequence=function(bT){return x.CreateLazy(function(){return v.Sequence(by.map(function(bU){return bU();},bT));});};x.UpdateWhile=function(bT,bU,bV){var bW;bW=[bT];return x.BindInner(function(bX){return bX?x.Map(function(bY){bW[0]=bY;return bY;},bV):x.Const(bW[0]);},bU);};x.BindInner=function(bT,bU){return x.JoinInner(x.Map(bT,bU));};x.JoinInner=function(bT){return x.CreateLazy(function(){return v.JoinInner(bT());});};x.Bind=function(bT,bU){return x.Join(x.Map(bT,bU));};x.Join=function(bT){return x.CreateLazy(function(){return v.Join(bT());});};x.MapSeqCachedView=function(bT,bU){function bV(bW){return bT;}return x.MapSeqCachedViewBy(a.id,function(bW,bX){return(bV(bW))(bX);},bU);};x.MapSeqCachedViewBy=function(bT,bU,bV){var bW;bW=[new bJ.New$5()];return x.Map(function(bX){var bY,bZ,b0;bY=bW[0];bZ=new bJ.New$5();b0=d.mapInPlace(function(b1){var b2,b3,b4;b2=bT(b1);b3=bY.ContainsKey(b2)?(b4=bY.get_Item(b2),(w.Set(b4.r,b1),b4)):x.ConvertSeqNode(function(b5){return bU(b2,b5);},b1);bZ.set_Item(b2,b3);return b3.e;},bs.ofSeq(bX));bW[0]=bZ;return b0;},bV);};x.ConvertSeqNode=function(bT,bU){var bV,bW;bV=w.Create$1(bU);bW=bV.get_View();return{e:bT(bW),r:bV,w:bW};};x.MapSeqCached=function(bT,bU){return x.MapSeqCachedBy(a.id,bT,bU);};x.MapSeqCachedBy=function(bT,bU,bV){var bW;bW=[new bJ.New$5()];return x.Map(function(bX){var bY,bZ,b0;bY=bW[0];bZ=new bJ.New$5();b0=d.mapInPlace(function(b1){var b2,b3;b2=bT(b1);b3=bY.ContainsKey(b2)?bY.get_Item(b2):bU(b1);bZ.set_Item(b2,b3);return b3;},bs.ofSeq(bX));bW[0]=bZ;return b0;},bV);};x.SnapshotOn=function(bT,bU,bV){var bW;bW=v.New({$:2,$0:bT,$1:[]});return x.CreateLazy(function(){return bW.s==null&&true?v.SnapshotOn(bU(),bV()):(v.WhenObsolete(bU(),bW),bW);});};x.GetAsync=function(bT){return bD.FromContinuations(function(bU){return x.Get(bU,bT);});};x.Get=function(bT,bU){var bV;function bW(){v.WhenRun(bU(),function(bX){if(!bV[0]){bV[0]=true;bT(bX);}},function(){if(!bV[0])bW();});}bV=[false];bW();};x.MapAsync2=function(bT,bU,bV){return x.MapAsync(a.id,x.Map2(bT,bU,bV));};x.MapAsync=function(bT,bU){return x.CreateLazy(function(){return v.MapAsync(bT,bU());});};x.Map3=function(bT,bU,bV,bW){return x.CreateLazy(function(){return v.Map3(bT,bU(),bV(),bW());});};x.Map2Unit=function(bT,bU){return x.CreateLazy(function(){return v.Map2Unit(bT(),bU());});};x.Map2=function(bT,bU,bV){return x.CreateLazy(function(){return v.Map2(bT,bU(),bV());});};x.MapCached=function(bT,bU){return x.MapCachedBy(bB.Equals,bT,bU);};x.MapCachedBy=function(bT,bU,bV){var bW;bW=[null];return x.CreateLazy(function(){return v.MapCachedBy(bT,bW,bU,bV());});};x.Map=function(bT,bU){return x.CreateLazy(function(){return v.Map(bT,bU());});};x.CreateLazy=function(bT){var bU;bU={c:null,o:bT};return function(){var bV,bW;bV=bU.c;return bV===null?(bV=bU.o(),bU.c=bV,(bW=bV.s,bW!=null&&bW.$==0)&&true?bU.o=null:v.WhenObsoleteRun(bV,function(){bU.c=null;}),bV):bV;};};A.B={$:0};B=c.Submitter=bA.Class({Trigger:function(){this["var"].Set(null);}},j,B);B.New=bA.Ctor(function(bT,bU){this.input=bT;this["var"]=w.Create();this.view=x.SnapshotOn(bU,this["var"].get_View(),this.input);},B);B.CreateOption=function(bT){return new B.New(x.Map(function(bU){return{$:1,$0:bU};},bT),null);};C.Fresh=function(){return{$:0,$0:g.Int()};};D=c.Model=bA.Class({},j,D);D.New=bA.Ctor(function(bT,bU){var bV;bV=w.Create$1(bU);D.New$1.call(this,bV,x.Map(bT,bV.get_View()));},D);D.New$1=bA.Ctor(function(bT,bU){this["var"]=bT;this.view=bU;},D);D.Update=function(bT,bU){w.Update(bU["var"],function(bV){bT(bV);return bV;});};D.Create=function(bT,bU){return new D.New(bT,bU);};E.Default=function(){K.$cctor();return K.Default;};G=F.ArrayStorage=bA.Class({SSet:function(bT){return bs.ofSeq(bT);},SSetAt:function(bT,bU,bV){bs.set(bV,bT,bU);return bV;},SRemoveIf:function(bT,bU){return bs.filter(function(bV){return!bT(bV);},bU);},SInit:function(){return this.init;},SPrependMany:function(bT,bU){var bV;bV=d.ofSeqNonCopying(bT);bU.unshift.apply(bU,bV);return bU;},SPrepend:function(bT,bU){bU.unshift(bT);return bU;},SAppendMany:function(bT,bU){var bV;bV=d.ofSeqNonCopying(bT);bU.push.apply(bU,bV);return bU;},SAppend:function(bT,bU){bU.push(bT);return bU;}},j,G);G.New=bA.Ctor(function(bT){this.init=bT;},G);H=F.LocalStorageBackend=bA.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bT){this.storage.setItem(this.id,bK.stringify(bs.map(this.serializer.Encode,bT)));return bT;},SSet:function(bT){return this.set(bs.ofSeq(bT));},SSetAt:function(bT,bU,bV){bs.set(bV,bT,bU);return this.set(bV);},SRemoveIf:function(bT,bU){return this.set(bs.filter(function(bV){return!bT(bV);},bU));},SInit:function(){var bT;bT=this.storage.getItem(this.id);if(bT===null)return[];else try{return bs.map(this.serializer.Decode,bK.parse(bT));}catch(bU){return[];}},SPrependMany:function(bT,bU){var bV;bV=d.ofSeqNonCopying(bT);bU.unshift.apply(bU,bV);return this.set(bU);},SPrepend:function(bT,bU){bU.unshift(bT);return this.set(bU);},SAppendMany:function(bT,bU){var bV;bV=d.ofSeqNonCopying(bT);bU.push.apply(bU,bV);return this.set(bU);},SAppend:function(bT,bU){bU.push(bT);return this.set(bU);}},j,H);H.New=bA.Ctor(function(bT,bU){this.id=bT;this.serializer=bU;this.storage=a.localStorage;},H);F.LocalStorage=function(bT,bU){return new H.New(bT,bU);};F.InMemory=function(bT){return new G.New(bT);};I=c.ListModel=bA.Class({Wrap:function(bT,bU,bV){return I.Wrap(this,bT,bU,bV);},MapLens:function(bT){var bU;bU=this;return x.MapSeqCachedViewBy(bU.key,function(bV,bW){return bT(bV,bU["LensInto'"](a.id,function(bX,bY){return bY;},bV,bW));},this["var"].get_View());},Lens:function(bT){return this.LensInto(a.id,function(bU,bV){return bV;},bT);},LensInto:function(bT,bU,bV){return this["LensInto'"](bT,bU,bV,x.Map(bT,this.FindByKeyAsView(bV)));},"LensInto'":function(bT,bU,bV,bW){var bX,bY,bZ,b0;bX=this;bY=g.Id();bZ=x.Map(bT,this.FindByKeyAsView(bV));b0=new w({Get:function(){return bT(bX.FindByKey(bV));},Set:function(b1){return bX.UpdateBy(function(b2){return{$:1,$0:bU(b2,b1)};},bV);},SetFinal:function(b1){return this.Set(b1);},Update:function(b1){return bX.UpdateBy(function(b2){return{$:1,$0:bU(b2,b1(bT(b2)))};},bV);},UpdateMaybe:function(b1){return bX.UpdateBy(function(b2){var b3;b3=b1(bT(b2));return b3==null?null:{$:1,$0:bU(b2,b3.$0)};},bV);},get_View:function(){return bZ;},get_Id:function(){return bY;}});w.New.call(b0);return b0;},get_LengthAsView:function(){return x.Map(bs.length,this["var"].get_View());},get_Length:function(){return bs.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bT,bU){var bV,bW,bX,bY,bZ;bV=this;bW=this["var"].Get();bX=bs.tryFindIndex(function(b0){return bB.Equals(bV.key(b0),bU);},bW);bX!=null&&bX.$==1?(bY=bX.$0,bZ=bT(bs.get(bW,bY)),bZ!=null&&bZ.$==1?(this["var"].Set(this.storage.SSetAt(bY,bZ.$0,bW)),this.ObsoleteKey(bU)):void 0):void 0;},UpdateAll:function(bT){var bU;bU=this;this["var"].Update(function(bV){bs.iteri(function(bW,bX){var bY;bY=bT(bX);return bY==null?null:bs.set(bV,bW,bY.$0);},bV);return bU.storage.SSet(bV);});this.ObsoleteAll();},FindByKeyAsView:function(bT){return x.Map(function(bU){return bU.$0;},this.TryFindByKeyAsView(bT));},TryFindByKeyAsView:function(bT){var bU;bU=this;return function(){var bV,bW,bX;bV=(bW=null,[bU.it.TryGetValue(bT,{get:function(){return bW;},set:function(bY){bW=bY;}}),bW]);return bV[0]?bV[1]:(bX=v.New({$:2,$0:bU.TryFindByKey(bT),$1:[]}),(bU.it.Add(bT,bX),bX));};},TryFindByKey:function(bT){var bU;bU=this;return bs.tryFind(function(bV){return bB.Equals(bU.key(bV),bT);},this["var"].Get());},FindByKey:function(bT){var bU;bU=this;return bs.find(function(bV){return bB.Equals(bU.key(bV),bT);},this["var"].Get());},TryFindAsView:function(bT){return x.Map(function(bU){return bs.tryFind(bT,bU);},this["var"].get_View());},FindAsView:function(bT){return x.Map(function(bU){return bs.find(bT,bU);},this["var"].get_View());},TryFind:function(bT){return bs.tryFind(bT,this["var"].Get());},Find:function(bT){return bs.find(bT,this["var"].Get());},ContainsKeyAsView:function(bT){var bU;function bV(bW){return bB.Equals(bU.key(bW),bT);}bU=this;return x.Map(function(bW){return bs.exists(bV,bW);},this["var"].get_View());},ContainsKey:function(bT){var bU;bU=this;return bs.exists(function(bV){return bB.Equals(bU.key(bV),bT);},this["var"].Get());},Set:function(bT){this["var"].Set(this.storage.SSet(bT));this.ObsoleteAll();},Iter:function(bT){bs.iter(bT,this["var"].Get());},RemoveByKey:function(bT){var bU;bU=this;this["var"].Set(this.storage.SRemoveIf(function(bV){return bB.Equals(bU.key(bV),bT);},this["var"].Get()));this.ObsoleteKey(bT);},RemoveBy:function(bT){var bU,bV,bW,bX;bU=this["var"].Get();for(bV=0,bW=bU.length-1;bV<=bW;bV++){bX=bs.get(bU,bV);bT(bX)?this.ObsoleteKey(this.key(bX)):void 0;}this["var"].Set(this.storage.SRemoveIf(bT,this["var"].Get()));},Remove:function(bT){var bU,bV,bW,bX;bU=this;bV=this["var"].Get();J.Contains(bU.key,bT,bV)?(bW=bU.key,bX=bW(bT),this["var"].Set(this.storage.SRemoveIf(function(bY){return bB.Equals(bW(bY),bX);},bV)),this.ObsoleteKey(bX)):void 0;},PrependMany:function(bT){var bU,bV;function bW(bX,bY){var bZ,b0;bZ=bU.key(bY);bU.ObsoleteKey(bZ);b0=bs.tryFindIndex(function(b1){return bB.Equals(bU.key(b1),bZ);},bX);return b0==null?(bV.push(bY),bX):bU.storage.SSetAt(b0.$0,bY,bX);}bU=this;bV=[];this["var"].Set(this.storage.SPrependMany(bV,(((bA.Curried3(by.fold))(bW))(this["var"].Get()))(bT)));},Prepend:function(bT){var bU,bV,bW,bX;bU=this;bV=this["var"].Get();bW=this.key(bT);bX=bs.tryFindIndex(function(bY){return bB.Equals(bU.key(bY),bW);},bV);bX!=null&&bX.$==1?this["var"].Set(this.storage.SSetAt(bX.$0,bT,bV)):this["var"].Set(this.storage.SPrepend(bT,bV));this.ObsoleteKey(bW);},AppendMany:function(bT){var bU,bV;function bW(bX,bY){var bZ,b0;bZ=bU.key(bY);bU.ObsoleteKey(bZ);b0=bs.tryFindIndex(function(b1){return bB.Equals(bU.key(b1),bZ);},bX);return b0==null?(bV.push(bY),bX):bU.storage.SSetAt(b0.$0,bY,bX);}bU=this;bV=[];this["var"].Set(this.storage.SAppendMany(bV,(((bA.Curried3(by.fold))(bW))(this["var"].Get()))(bT)));},Append:function(bT){var bU,bV,bW,bX;bU=this;bV=this["var"].Get();bW=this.key(bT);bX=bs.tryFindIndex(function(bY){return bB.Equals(bU.key(bY),bW);},bV);bX!=null&&bX.$==1?this["var"].Set(this.storage.SSetAt(bX.$0,bT,bV)):this["var"].Set(this.storage.SAppend(bT,bV));this.ObsoleteKey(bW);},ObsoleteAll:function(){by.iter(function(bT){v.Obsolete(bT.V);},this.it);this.it.Clear();},ObsoleteKey:function(bT){var bU,bV;bU=(bV=null,[this.it.TryGetValue(bT,{get:function(){return bV;},set:function(bW){bV=bW;}}),bV]);bU[0]?(v.Obsolete(bU[1]),this.it.Remove(bT)):void 0;},GetEnumerator0:function(){return bt.Get0(this["var"].Get());},GetEnumerator:function(){return bt.Get(this["var"].Get());}},j,I);I.New=bA.Ctor(function(bT,bU){I.New$3.call(this,bT,w.Create$1(bs.ofSeq(by.distinctBy(bT,bU.SInit()))),bU);},I);I.New$1=bA.Ctor(function(bT){I.New$2.call(this,bT,[]);},I);I.New$2=bA.Ctor(function(bT,bU){var bV;bV=bs.ofSeq(bU);I.New$3.call(this,bT,w.Create$1(bV),F.InMemory(bV));},I);I.New$3=bA.Ctor(function(bT,bU,bV){this.key=bT;this["var"]=bU;this.storage=bV;this.v=x.Map(function(bW){return bW.slice();},this["var"].get_View());this.it=new bJ.New$5();},I);J.Contains=function(bT,bU,bV){var bW;bW=bT(bU);return bs.exists(function(bX){return bB.Equals(bT(bX),bW);},bV);};I.Wrap=function(bT,bU,bV,bW){var bX,bY;bX=[new bJ.New$5()];bY=bs.map(function(bZ){var b0;b0=bV(bZ);bX[0].set_Item(bT.key(bZ),b0);return b0;},bT["var"].Get());return new I.New$3(function(bZ){return bT.key(bU(bZ));},w.Lens(bT["var"],function(bZ){var b0,b1;b0=new bJ.New$5();b1=bs.map(function(b2){var b3,b4;b3=bT.key(b2);b4=bX[0].ContainsKey(b3)?bW(bX[0].get_Item(b3),b2):bV(b2);b0.set_Item(b3,b4);return b4;},bZ);bX[0]=b0;return b1;},function(bZ,b0){var b1,b2;b1=new bJ.New$5();b2=bs.map(function(b3){var b4;b4=bU(b3);b1.set_Item(bT.key(b4),b3);return b4;},b0);bX[0]=b1;return b2;}),F.InMemory(bY));};I.FromSeq=function(bT){return I.Create(a.id,bT);};I.Create=function(bT,bU){return I.CreateWithStorage(bT,F.InMemory(bs.ofSeq(bU)));};I.CreateWithStorage=function(bT,bU){return new I.New(bT,bU);};K.$cctor=function(){K.$cctor=a.ignore;K.Default={Encode:a.id,Decode:a.id};};L=c.ReactiveExtensions=bA.Class({},j,L);L.New=bA.Ctor(function(){},L);M=c.DoubleInterpolation=bA.Class({Interpolate:function(bT,bU,bV){return bU+bT*(bV-bU);}},null,M);M.DoubleInterpolation=new M({$:0});N.get_Double=function(){return M.DoubleInterpolation;};O=c.Easing=bA.Class({TransformTime:function(bT){return this.transformTime(bT);}},j,O);O.get_CubicInOut=function(){return P.CubicInOut();};O.Custom=function(bT){return new O.New(bT);};O.New=bA.Ctor(function(bT){this.transformTime=bT;},O);P.CubicInOut=function(){T.$cctor();return T.CubicInOut;};Q.get_Empty=function(){return{$:0,$0:o.Empty()};};Q.WhenDone=function(bT,bU){return Q.Append({$:0,$0:o.Single({$:0,$0:bT})},bU);};Q.Run=function(bT,bU){var bV;function bW(bX){function bY(bZ,b0){var b1;b1=b0-bZ;bU.Compute(b1);bT();return b1<=bV?void a.requestAnimationFrame(function(b2){bY(bZ,b2);}):bX();}a.requestAnimationFrame(function(bZ){bY(bZ,bZ);});}bV=bU.Duration;return bV===0?bD.Zero():bD.FromContinuations(function(bX,bY,bZ){return bW.apply(null,[bX,bY,bZ]);});};Q.Play=function(bT){var bU;bU=null;return bD.Delay(function(){return bD.Bind(Q.Run(a.ignore,R.Actions(bT)),function(){R.Finalize(bT);return bD.Return(null);});});};Q.Pack=function(bT){return{$:0,$0:o.Single({$:1,$0:bT})};};Q.Map=function(bT,bU){var bV;return R.Def(bU.Duration,(bV=bU.Compute,function(bW){return bT(bV(bW));}));};Q.Delayed=function(bT,bU,bV,bW,bX,bY){return{Compute:function(bZ){return bZ<=bW?bX:bT.Interpolate(bU.TransformTime((bZ-bW)/bV),bX,bY);},Duration:bV+bW};};Q.Simple=function(bT,bU,bV,bW,bX){return{Compute:function(bY){return bT.Interpolate(bU.TransformTime(bY/bV),bW,bX);},Duration:bV};};Q.Const=function(bT){return R.Const(bT);};Q.Concat=function(bT){return{$:0,$0:o.Concat(by.map(R.List,bT))};};Q.Append=function(bT,bU){return{$:0,$0:o.Append(bT.$0,bU.$0)};};Q.set_UseAnimations=function(bT){R.set_UseAnimations(bT);};Q.get_UseAnimations=function(){return R.UseAnimations();};R.UseAnimations=function(){T.$cctor();return T.UseAnimations;};R.set_UseAnimations=function(bT){T.$cctor();T.UseAnimations=bT;};R.Actions=function(bT){return R.ConcatActions(bs.choose(function(bU){return bU.$==1?{$:1,$0:bU.$0}:null;},o.ToArray(bT.$0)));};R.ConcatActions=function(bT){var bU,bV,bW,bX;bU=d.ofSeqNonCopying(bT);bV=bs.length(bU);return bV===0?R.Const():bV===1?bs.get(bU,0):(bW=by.max(by.map(function(bY){return bY.Duration;},bU)),(bX=bs.map(function(bY){return R.Prolong(bW,bY);},bU),R.Def(bW,function(bY){bs.iter(function(bZ){bZ.Compute(bY);},bX);})));};R.Prolong=function(bT,bU){var bV,bW,bX;bV=bU.Compute;bW=bU.Duration;bX=bI.Create(function(){return bU.Compute(bU.Duration);});return{Compute:function(bY){return bY>=bW?bX.f():bV(bY);},Duration:bT};};R.Const=function(bT){return R.Def(0,function(){return bT;});};R.Def=function(bT,bU){return{Compute:bU,Duration:bT};};R.Finalize=function(bT){bs.iter(function(bU){if(bU.$==0)bU.$0();},o.ToArray(bT.$0));};R.List=function(bT){return bT.$0;};S=c.Trans=bA.Class({Copy:function(bT,bU,bV,bW){var bX,bY,bZ,b0,b1;function b2(b3,b4){return bX.TChange(b3,b4);}bX=this;bY=bT==null?function(b3){return function(b4){return b2(b3,b4);};}:bT.$0;return new S.New$3(function(b3,b4){return(bY(b3))(b4);},(bZ=this.get_TEnter(),bU==null?bZ:bU.$0),(b0=this.get_TExit(),bV==null?b0:bV.$0),(b1=this.get_TFlags(),bW==null?b1:bW.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bT,bU){return this.change(bT,bU);}},j,S);S.New=bA.Ctor(function(bT,bU,bV){S.New$3.call(this,bT,bB.Equals(bU,null)?Q.Const:bU,bB.Equals(bV,null)?Q.Const:bV,1|(bB.Equals(bU,null)?0:2)|(bB.Equals(bV,null)?0:4));},S);S.New$1=bA.Ctor(function(bT){S.New$3.call(this,bT,Q.Const,Q.Const,1);},S);S.New$2=bA.Ctor(function(){S.New$3.call(this,function(bT,bU){return Q.Const(bU);},Q.Const,Q.Const,0);},S);S.New$3=bA.Ctor(function(bT,bU,bV,bW){this.change=bT;this.enter=bU;this.exit=bV;this.flags=bW;},S);S.Exit=function(bT,bU){return bU.Copy(null,null,{$:1,$0:bT},{$:1,$0:bU.get_TFlags()|4});};S.Enter=function(bT,bU){return bU.Copy(null,{$:1,$0:bT},null,{$:1,$0:bU.get_TFlags()|2});};S.Change=function(bT,bU){return bU.Copy({$:1,$0:bT},null,null,{$:1,$0:bU.get_TFlags()|1});};S.Create=function(bT){return new S.New$1(bT);};S.Trivial=function(){return new S.New$2();};S.CanAnimateExit=function(bT){var bU,bV;bU=bT.get_TFlags();bV=4;return(bU&bV)===bV;};S.CanAnimateEnter=function(bT){var bU,bV;bU=bT.get_TFlags();bV=2;return(bU&bV)===bV;};S.CanAnimateChange=function(bT){var bU,bV;bU=bT.get_TFlags();bV=1;return(bU&bV)===bV;};S.AnimateExit=function(bT,bU){return(bT.get_TExit())(bU);};S.AnimateEnter=function(bT,bU){return(bT.get_TEnter())(bU);};S.AnimateChange=function(bT,bU,bV){return bT.TChange(bU,bV);};T.$cctor=function(){T.$cctor=a.ignore;T.CubicInOut=O.Custom(function(bT){var bU;bU=bT*bT;return 3*bU-2*(bU*bT);});T.UseAnimations=true;};U=c.AnimatedAttrNode=bA.Class({sync:function(bT){var bU;if(this.dirty){bU=this.logical;bU==null?void 0:(this.push(bT))(bU.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bT,bU){this.visible={$:1,$0:bU};this.dirty=true;(this.push(bT))(bU);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(bT){var bU,bV;bU=this;return Q.WhenDone(function(){bU.dirty=true;bU.visible=null;},(bV=this.visible,bV!=null&&bV.$==1?Q.Pack(Q.Map(function(bW){bU.pushVisible(bT,bW);},S.AnimateExit(this.tr,bV.$0))):Q.get_Empty()));},NGetEnterAnim:function(bT){var bU,bV,bW,bX,bY;bU=this;return Q.WhenDone(function(){bU.sync(bT);},(bV=this.visible,(bW=this.logical,bV!=null&&bV.$==1&&(bW!=null&&bW.$==1&&(this.dirty&&(bX=[bW.$0,bV.$0],true)))?Q.Pack(Q.Map(function(bZ){bU.pushVisible(bT,bZ);},S.AnimateChange(this.tr,bX[1],bX[0]))):bV==null&&(bW!=null&&bW.$==1&&true)?Q.Pack(Q.Map(function(bZ){bU.pushVisible(bT,bZ);},S.AnimateEnter(this.tr,bW.$0))):Q.get_Empty())));},NGetChangeAnim:function(bT){var bU,bV,bW,bX;bU=this;return Q.WhenDone(function(){bU.sync(bT);},(bV=this.visible,(bW=this.logical,bV!=null&&bV.$==1&&(bW!=null&&bW.$==1&&(this.dirty&&(bX=[bW.$0,bV.$0],true)))?Q.Pack(Q.Map(function(bY){bU.pushVisible(bT,bY);},S.AnimateChange(this.tr,bX[1],bX[0]))):Q.get_Empty())));}},j,U);U.New=bA.Ctor(function(bT,bU,bV){var bW;bW=this;this.tr=bT;this.push=bV;this.logical=null;this.visible=null;this.dirty=true;this.updates=x.Map(function(bX){bW.logical={$:1,$0:bX};bW.dirty=true;},bU);},U);V=c.DynamicAttrNode=bA.Class({NChanged:function(){return this.updates;},NSync:function(bT){if(this.dirty){(this.push(bT))(this.value);this.dirty=false;}},NGetExitAnim:function(bT){return Q.get_Empty();},NGetEnterAnim:function(bT){return Q.get_Empty();},NGetChangeAnim:function(bT){return Q.get_Empty();}},j,V);V.New=bA.Ctor(function(bT,bU){var bV;bV=this;this.push=bU;this.value=void 0;this.dirty=false;this.updates=x.Map(function(bW){bV.value=bW;bV.dirty=true;},bT);},V);W=c.AttrProxy=bA.Class({},null,W);W.Handler=function(bT,bU){return W.HandlerImpl(bT,bU);};W.HandlerImpl=function(bT,bU){return _0.Static(function(bV){bV.addEventListener(bT,function(bW){return(bU(bV))(bW);},false);});};W.Concat=function(bT){var bU;bU=d.ofSeqNonCopying(bT);return d.TreeReduce(_0.EmptyAttr(),W.Append,bU);};W.Append=function(bT,bU){return _0.AppendTree(bT,bU);};W.Create=function(bT,bU){return _0.Static(function(bV){q.SetAttr(bV,bT,bU);});};Z.New=function(bT,bU,bV,bW){var bX;bX={DynElem:bT,DynFlags:bU,DynNodes:bV};bA.SetOptional(bX,"OnAfterRender",bW);return bX;};_0.Static=function(bT){return new W({$:3,$0:bT});};_0.Dynamic=function(bT,bU){return new W({$:1,$0:new V.New(bT,bU)});};_0.Animated=function(bT,bU,bV){var bW,bX,bY;bW=new U.New(bT,bU,bV);bX=4;S.CanAnimateEnter(bT)?bX=bX|1:void 0;S.CanAnimateExit(bT)?bX=bX|2:void 0;bY=new W({$:1,$0:bW});_0.SetFlags(bY,bX);return bY;};_0.EmptyAttr=function(){_3.$cctor();return _3.EmptyAttr;};_0.AppendTree=function(bT,bU){var bV;return bT===null?bU:bU===null?bT:(bV=new W({$:2,$0:bT,$1:bU}),(_0.SetFlags(bV,_0.Flags(bT)|_0.Flags(bU)),bV));};_0.GetChangeAnim=function(bT){return _0.GetAnim(bT,function(bU,bV){return bU.NGetChangeAnim(bV);});};_0.GetExitAnim=function(bT){return _0.GetAnim(bT,function(bU,bV){return bU.NGetExitAnim(bV);});};_0.GetEnterAnim=function(bT){return _0.GetAnim(bT,function(bU,bV){return bU.NGetEnterAnim(bV);});};_0.GetAnim=function(bT,bU){return Q.Concat(bs.map(function(bV){return bU(bV,bT.DynElem);},bT.DynNodes));};_0.Updates=function(bT){return d.MapTreeReduce(function(bU){return bU.NChanged();},x.Const(),x.Map2Unit,bT.DynNodes);};_0.Empty=function(bT){return Z.New(bT,0,[],null);};_0.Insert=function(bT,bU){var bV,bW,bX;function bY(bZ){if(!(bZ===null))if(bZ!=null&&bZ.$==1)bV.push(bZ.$0);else if(bZ!=null&&bZ.$==2){bY(bZ.$0);bY(bZ.$1);}else if(bZ!=null&&bZ.$==3)bZ.$0(bT);else if(bZ!=null&&bZ.$==4)bW.push(bZ.$0);}bV=[];bW=[];bY(bU);bX=bV.slice(0);return Z.New(bT,_0.Flags(bU),bX,bW.length===0?null:{$:1,$0:function(bZ){by.iter(function(b0){b0(bZ);},bW);}});};_0.Sync=function(bT,bU){bs.iter(function(bV){bV.NSync(bT);},bU.DynNodes);};_0.SetFlags=function(bT,bU){bT.flags=bU;};_0.Flags=function(bT){return bT!==null&&bT.hasOwnProperty("flags")?bT.flags:0;};_0.HasExitAnim=function(bT){var bU;bU=2;return(bT.DynFlags&bU)===bU;};_0.HasEnterAnim=function(bT){var bU;bU=1;return(bT.DynFlags&bU)===bU;};_0.HasChangeAnim=function(bT){var bU;bU=4;return(bT.DynFlags&bU)===bU;};_1=c.CheckedInput=bA.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_1);_1.Make=function(bT){return new _1({$:0,$0:bT,$1:a.String(bT)});};_2.ValidateForm=function(){return _2.OnAfterRender(function(bT){if(window.H5F)window.H5F.setup(bT);});};_2.Checked=function(bT){function bU(bV,bW){return!bB.Equals(bT.Get(),bV.checked)?bT.Set(bV.checked):null;}return W.Concat([_2.DynamicProp("checked",bT.get_View()),_2.Handler("change",function(bV){return function(bW){return bU(bV,bW);};}),_2.Handler("click",function(bV){return function(bW){return bU(bV,bW);};})]);};_2.FloatValue=function(bT){return _2.CustomVar(bT,function(bU,bV){var bW;bW=bV.get_Input();return bU.value!==bW?void(bU.value=bW):null;},function(bU){var bV,bW;bV=bU.value;return{$:1,$0:e.isBlank(bV)?(bU.checkValidity?bU.checkValidity():true)?new _1({$:2,$0:bV}):new _1({$:1,$0:bV}):(bW=+bV,a.isNaN(bW)?new _1({$:1,$0:bV}):new _1({$:0,$0:bW,$1:bV}))};});};_2.FloatValueUnchecked=function(bT){return _2.CustomValue(bT,a.String,function(bU){var bV;return e.isBlank(bU)?{$:1,$0:0}:(bV=+bU,a.isNaN(bV)?null:{$:1,$0:bV});});};_2.IntValue=function(bT){return _2.CustomVar(bT,function(bU,bV){var bW;bW=bV.get_Input();return bU.value!==bW?void(bU.value=bW):null;},function(bU){var bV,bW,bX;bV=bU.value;return{$:1,$0:e.isBlank(bV)?(bU.checkValidity?bU.checkValidity():true)?new _1({$:2,$0:bV}):new _1({$:1,$0:bV}):(bW=(bX=0,[bL.TryParseInt32(bV,{get:function(){return bX;},set:function(bY){bX=bY;}}),bX]),bW[0]?new _1({$:0,$0:bW[1],$1:bV}):new _1({$:1,$0:bV}))};});};_2.IntValueUnchecked=function(bT){return _2.CustomValue(bT,a.String,function(bU){var bV;return e.isBlank(bU)?{$:1,$0:0}:(bV=+bU,bV!==bV>>0?null:{$:1,$0:bV});});};_2.Value=function(bT){function bU(bV){return{$:1,$0:bV};}return _2.CustomValue(bT,a.id,function(bV){return bU(a.id(bV));});};_2.ContentEditableHtml=function(bT){var bU;bU=_2.CustomVar(bT,function(bV,bW){bV.innerHTML=bW;},function(bV){return{$:1,$0:bV.innerHTML};});return W.Append(W.Create("contenteditable","true"),bU);};_2.ContentEditableText=function(bT){var bU;bU=_2.CustomVar(bT,function(bV,bW){bV.textContent=bW;},function(bV){return{$:1,$0:bV.textContent};});return W.Append(W.Create("contenteditable","true"),bU);};_2.CustomValue=function(bT,bU,bV){return _2.CustomVar(bT,function(bW,bX){bW.value=bU(bX);},function(bW){return bV(bW.value);});};_2.CustomVar=function(bT,bU,bV){function bW(bY,bZ){return bT.UpdateMaybe(function(b0){var b1,b2;b1=bV(bY);return b1!=null&&b1.$==1&&(!bB.Equals(b1.$0,b0)&&(b2=[b1,b1.$0],true))?b2[0]:null;});}function bX(bY,bZ){var b0,b1;b0=bV(bY);return b0!=null&&b0.$==1&&(bB.Equals(b0.$0,bZ)&&(b1=b0.$0,true))?null:bU(bY,bZ);}return W.Concat([_2.Handler("change",function(bY){return function(bZ){return bW(bY,bZ);};}),_2.Handler("input",function(bY){return function(bZ){return bW(bY,bZ);};}),_2.Handler("keypress",function(bY){return function(bZ){return bW(bY,bZ);};}),_2.DynamicCustom(function(bY){return function(bZ){return bX(bY,bZ);};},bT.get_View())]);};_2.DynamicProp=function(bT,bU){return _0.Dynamic(bU,function(bV){return function(bW){bV[bT]=bW;};});};_2.DynamicPred=function(bT,bU,bV){function bW(bX,bY){return bY[0]?q.SetAttr(bX,bT,bY[1]):q.RemoveAttr(bX,bT);}return _0.Dynamic(x.Map2(function(bX,bY){return[bX,bY];},bU,bV),function(bX){return function(bY){return bW(bX,bY);};});};_2.DynamicClass=function(bT,bU,bV){return _0.Dynamic(bU,function(bW){return function(bX){return bV(bX)?q.AddClass(bW,bT):q.RemoveClass(bW,bT);};});};_2.OnAfterRenderView=function(bT,bU){var bV;bV=g.Id();return W.Append(_2.OnAfterRender(function(bW){bU(bW,bW[bV]);}),_2.DynamicCustom(function(bW){return function(bX){bW[bV]=bX;};},bT));};_2.OnAfterRender=function(bT){return new W({$:4,$0:bT});};_2.HandlerView=function(bT,bU,bV){return _0.Static(function(bW){var bX;bX=bV(bW);bW.addEventListener(bT,function(bY){return x.Get(bX(bY),bU);},false);});};_2.Handler=function(bT,bU){return _0.Static(function(bV){bV.addEventListener(bT,function(bW){return(bU(bV))(bW);},false);});};_2.DynamicStyle=function(bT,bU){return _0.Dynamic(bU,function(bV){return function(bW){return q.SetStyle(bV,bT,bW);};});};_2.DynamicCustom=function(bT,bU){return _0.Dynamic(bU,bT);};_2.Dynamic=function(bT,bU){return _0.Dynamic(bU,function(bV){return function(bW){return q.SetAttr(bV,bT,bW);};});};_2.AnimatedStyle=function(bT,bU,bV,bW){return _0.Animated(bU,bV,function(bX){return function(bY){return q.SetStyle(bX,bT,bW(bY));};});};_2.Animated=function(bT,bU,bV,bW){return _0.Animated(bU,bV,function(bX){return function(bY){return q.SetAttr(bX,bT,bW(bY));};});};_2.Class=function(bT){return _0.Static(function(bU){q.AddClass(bU,bT);});};_2.Style=function(bT,bU){return _0.Static(function(bV){q.SetStyle(bV,bT,bU);});};_3.$cctor=function(){_3.$cctor=a.ignore;_3.EmptyAttr=null;};_4=c.DocElemNode=bA.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bT){return this.ElKey===bT.ElKey;}},null,_4);_4.New=function(bT,bU,bV,bW,bX,bY){var bZ;return new _4((bZ={Attr:bT,Children:bU,El:bW,ElKey:bX},(bA.SetOptional(bZ,"Delimiters",bV),bA.SetOptional(bZ,"Render",bY),bZ)));};_6.FoldBack=function(bT,bU,bV){return bs.foldBack(bT,bU.$0,bV);};_6.Iter=function(bT,bU){bs.iter(bT,bU.$0);};_6.Except=function(bT,bU){var bV;bV=bT.$0;return{$:0,$0:bs.filter(function(bW){return bs.forall(function(bX){return!(bW===bX);},bV);},bU.$0)};};_6.DocChildren=function(bT){var bU;function bV(bW){if(bW!=null&&bW.$==2)bV(bW.$0.Current);else if(bW!=null&&bW.$==1)bU.push(bW.$0.El);else if(bW==null);else if(bW!=null&&bW.$==5)bU.push(bW.$0);else if(bW!=null&&bW.$==4)bU.push(bW.$0.Text);else if(bW!=null&&bW.$==6)bs.iter(function(bX){if(bX.constructor===a.Object)bV(bX);else bU.push(bX);},bW.$0.Els);else{bV(bW.$0);bV(bW.$1);}}bU=[];bV(bT.Children);return{$:0,$0:d.ofSeqNonCopying(bU)};};_6.Children=function(bT,bU){var bV,bW,bX;if(bU!=null&&bU.$==1){bX=[];bV=bU.$0[0].nextSibling;while(bV!==bU.$0[1]){bX.push(bV);bV=bV.nextSibling;}return{$:0,$0:bX};}else return{$:0,$0:bs.init(bT.childNodes.length,(bW=bT.childNodes,function(bY){return bW[bY];}))};};_7.ToArray=function(bT){return h.ToArray(bT.$0);};_7.get_Empty=function(){return{$:0,$0:new bx.New$3()};};_7.IsEmpty=function(bT){return bT.$0.get_Count()===0;};_7.Intersect=function(bT,bU){return{$:0,$0:h.Intersect(bT.$0,bU.$0)};};_7.Except=function(bT,bU){return{$:0,$0:h.Except(bT.$0,bU.$0)};};_7.FindAll=function(bT){var bU;function bV(bX){if(bX!=null&&bX.$==0){bV(bX.$0);bV(bX.$1);}else if(bX!=null&&bX.$==1)bW(bX.$0);else if(bX!=null&&bX.$==2)bV(bX.$0.Current);else if(bX!=null&&bX.$==6)bs.iter(bW,bX.$0.Holes);}function bW(bX){bU.push(bX);bV(bX.Children);}bU=[];bV(bT);return{$:0,$0:new bx.New$2(bU)};};_7.Filter=function(bT,bU){return{$:0,$0:h.Filter(bT,bU.$0)};};_8.New=function(bT,bU){return{PreviousNodes:bT,Top:bU};};_9.TextHoleRE=function(){bb.$cctor();return bb.TextHoleRE;};_9.LocalTemplatesLoaded=function(){bb.$cctor();return bb.LocalTemplatesLoaded;};_9.set_LocalTemplatesLoaded=function(bT){bb.$cctor();bb.LocalTemplatesLoaded=bT;};_9.LoadedTemplateFile=function(bT){var bU,bV,bW;bU=(bV=null,[_9.LoadedTemplates().TryGetValue(bT,{get:function(){return bV;},set:function(bX){bV=bX;}}),bV]);return bU[0]?bU[1]:(bW=new bJ.New$5(),(_9.LoadedTemplates().set_Item(bT,bW),bW));};_9.LoadedTemplates=function(){bb.$cctor();return bb.LoadedTemplates;};_9.UpdateTextNode=function(bT,bU){bT.Value=bU;bT.Dirty=true;};_9.CreateTextNode=function(){return{Text:q.CreateText(""),Dirty:false,Value:""};};_9.UpdateEmbedNode=function(bT,bU){bT.Current=bU;bT.Dirty=true;};_9.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_9.PerformAnimatedUpdate=function(bT,bU){var bV;return Q.get_UseAnimations()?(bV=null,bD.Delay(function(){var bW,bX,bY;bW=_7.FindAll(bU);bX=_9.ComputeChangeAnim(bT,bW);bY=_9.ComputeEnterAnim(bT,bW);return bD.Bind(Q.Play(Q.Append(bX,_9.ComputeExitAnim(bT,bW))),function(){return bD.Bind(_9.SyncElemNodesNextFrame(bT),function(){return bD.Bind(Q.Play(bY),function(){bT.PreviousNodes=bW;return bD.Return(null);});});});})):_9.SyncElemNodesNextFrame(bT);};_9.SyncElemNodesNextFrame=function(bT){function bU(bV){a.requestAnimationFrame(function(){_9.SyncElemNode(bT.Top);bV();});}return bD.FromContinuations(function(bV,bW,bX){return bU.apply(null,[bV,bW,bX]);});};_9.ComputeEnterAnim=function(bT,bU){return Q.Concat(bs.map(function(bV){return _0.GetEnterAnim(bV.Attr);},_7.ToArray(_7.Except(bT.PreviousNodes,_7.Filter(function(bV){return _0.HasEnterAnim(bV.Attr);},bU)))));};_9.ComputeChangeAnim=function(bT,bU){var bV;function bW(bX){return _0.HasChangeAnim(bX.Attr);}bV=function(bX){return _7.Filter(bW,bX);};return Q.Concat(bs.map(function(bX){return _0.GetChangeAnim(bX.Attr);},_7.ToArray(_7.Intersect(bV(bT.PreviousNodes),bV(bU)))));};_9.ComputeExitAnim=function(bT,bU){return Q.Concat(bs.map(function(bV){return _0.GetExitAnim(bV.Attr);},_7.ToArray(_7.Except(bU,_7.Filter(function(bV){return _0.HasExitAnim(bV.Attr);},bT.PreviousNodes)))));};_9.CreateDelimitedRunState=function(bT,bU,bV){return _8.New(_7.get_Empty(),_9.CreateDelimitedElemNode(bT,bU,_0.EmptyAttr(),bV));};_9.CreateRunState=function(bT,bU){return _8.New(_7.get_Empty(),_9.CreateElemNode(bT,_0.EmptyAttr(),bU));};_9.CreateDelimitedElemNode=function(bT,bU,bV,bW){var bX,bY;bX=bT.parentNode;_9.LinkPrevElement(bU,bW);bY=_0.Insert(bX,bV);return _4.New(bY,bW,{$:1,$0:[bT,bU]},bX,g.Int(),bA.GetOptional(bY.OnAfterRender));};_9.CreateElemNode=function(bT,bU,bV){var bW;_9.LinkElement(bT,bV);bW=_0.Insert(bT,bU);return _4.New(bW,bV,null,bT,g.Int(),bA.GetOptional(bW.OnAfterRender));};_9.SyncElemNode=function(bT){_9.SyncElement(bT);_9.Sync(bT.Children);_9.AfterRender(bT);};_9.Sync=function(bT){var bU,bV;if(bT!=null&&bT.$==1)_9.SyncElemNode(bT.$0);else if(bT!=null&&bT.$==2)_9.Sync(bT.$0.Current);else if(bT==null);else if(bT!=null&&bT.$==5);else if(bT!=null&&bT.$==4){bU=bT.$0;bU.Dirty?(bU.Text.nodeValue=bU.Value,bU.Dirty=false):void 0;}else if(bT!=null&&bT.$==6){bV=bT.$0;bs.iter(function(bW){_9.SyncElemNode(bW);},bV.Holes);bs.iter(function(bW){_0.Sync(bW[0],bW[1]);},bV.Attrs);_9.AfterRender(bV);}else{_9.Sync(bT.$0);_9.Sync(bT.$1);}};_9.AfterRender=function(bT){var bU;bU=bA.GetOptional(bT.Render);bU!=null&&bU.$==1?(bU.$0(bT.El),bA.SetOptional(bT,"Render",null)):void 0;};_9.InsertBeforeDelim=function(bT,bU){var bV,bW;bV=bT.parentNode;bW=a.document.createTextNode("");bV.insertBefore(bW,bT);_9.LinkPrevElement(bT,bU);return bW;};_9.LinkPrevElement=function(bT,bU){_9.InsertDoc(bT.parentNode,bU,bT);};_9.LinkElement=function(bT,bU){_9.InsertDoc(bT,bU,null);};_9.SyncElement=function(bT){function bU(bV){function bW(bX){var bY,bZ;return bX!=null&&bX.$==0?bW(bX.$0)||bW(bX.$1):bX!=null&&bX.$==2?(bY=bX.$0,bY.Dirty||bW(bY.Current)):bX!=null&&bX.$==6&&(bZ=bX.$0,bZ.Dirty||bs.exists(bU,bZ.Holes));}return bW(bV.Children);}_0.Sync(bT.El,bT.Attr);bU(bT)?_9.DoSyncElement(bT):void 0;};_9.DoSyncElement=function(bT){var bU,bV,bW;function bX(bY,bZ){var b0,b1;return bY!=null&&bY.$==1?bY.$0.El:bY!=null&&bY.$==2?(b0=bY.$0,b0.Dirty?(b0.Dirty=false,_9.InsertDoc(bU,b0.Current,bZ)):bX(b0.Current,bZ)):bY==null?bZ:bY!=null&&bY.$==4?bY.$0.Text:bY!=null&&bY.$==5?bY.$0:bY!=null&&bY.$==6?(b1=bY.$0,(b1.Dirty?b1.Dirty=false:void 0,bs.foldBack(function(b2,b3){return b2.constructor===a.Object?bX(b2,b3):b2;},b1.Els,bZ))):bX(bY.$0,bX(bY.$1,bZ));}bU=bT.El;_6.Iter((bV=bT.El,function(bY){q.RemoveNode(bV,bY);}),_6.Except(_6.DocChildren(bT),_6.Children(bT.El,bA.GetOptional(bT.Delimiters))));bX(bT.Children,(bW=bA.GetOptional(bT.Delimiters),bW!=null&&bW.$==1?bW.$0[1]:null));};_9.InsertDoc=function(bT,bU,bV){var bW;return bU!=null&&bU.$==1?_9.InsertNode(bT,bU.$0.El,bV):bU!=null&&bU.$==2?(bW=bU.$0,(bW.Dirty=false,_9.InsertDoc(bT,bW.Current,bV))):bU==null?bV:bU!=null&&bU.$==4?_9.InsertNode(bT,bU.$0.Text,bV):bU!=null&&bU.$==5?_9.InsertNode(bT,bU.$0,bV):bU!=null&&bU.$==6?bs.foldBack(function(bX,bY){return bX.constructor===a.Object?_9.InsertDoc(bT,bX,bY):_9.InsertNode(bT,bX,bY);},bU.$0.Els,bV):_9.InsertDoc(bT,bU.$0,_9.InsertDoc(bT,bU.$1,bV));};_9.InsertNode=function(bT,bU,bV){q.InsertAt(bT,bV,bU);return bU;};_=c.Doc=bA.Class({ReplaceInDom:function(bT){var bU;bU=a.document.createTextNode("");bT.parentNode.replaceChild(bU,bT);_.RunBefore(bU,this);}},j,_);_.Append=function(bT,bU){return _.Mk({$:0,$0:bT.docNode,$1:bU.docNode},x.Map2Unit(bT.updates,bU.updates));};_.Concat=function(bT){var bU;bU=d.ofSeqNonCopying(bT);return d.TreeReduce(_.Empty(),_.Append,bU);};_.Empty=function(){return _.Mk(null,x.Const());};_.TextNode=function(bT){return _.Mk({$:5,$0:q.CreateText(bT)},x.Const());};_.Verbatim=function(bT){var bU;return _.Mk(d.MapTreeReduce(function(bV){return bB.Equals(bV.nodeType,bM.TEXT_NODE)?{$:5,$0:bV}:{$:1,$0:_9.CreateElemNode(bV,_0.EmptyAttr(),null)};},null,function(bV,bW){return{$:0,$0:bV,$1:bW};},(bU=bN.parseHTML(bT),bB.Equals(bU,null)?[]:bU)),x.Const());};_.SvgElementMixed=function(bT,bU){var bV;bV=_.MixedNodes(bU);return _.SvgElement(bT,bV[0],bV[1]);};_.SvgElement=function(bT,bU,bV){var bW,bX;bW=W.Concat(bU);bX=_.Concat(bV);return $.New(q.CreateSvgElement(bT),bW,bX);};_.ElementMixed=function(bT,bU){var bV;bV=_.MixedNodes(bU);return _.Element(bT,bV[0],bV[1]);};_.ConcatMixed=function(bT){return _.Concat(by.map(_.ToMixedDoc,bT));};_.MixedNodes=function(bT){var bU,bV,bW,bX;bU=[];bV=[];bW=bt.Get(bT);try{while(bW.MoveNext()){bX=bW.Current();bX instanceof W?bU.push(bX):bV.push(_.ToMixedDoc(bX));}}finally{if("Dispose"in bW)bW.Dispose();}return[bU,bV];};_.ToMixedDoc=function(bT){return bT instanceof _?bT:typeof bT=="string"?_.TextNode(bT):bT instanceof a.Element?_.Static(bT):typeof bT=="function"?_.EmbedView(x.Map(_.ToMixedDoc,bT)):bT instanceof w?_.EmbedView(x.Map(_.ToMixedDoc,bT.get_View())):bB.Equals(bT,null)?_.Empty():_.TextNode(a.String(bT));};_.Element=function(bT,bU,bV){var bW,bX;bW=W.Concat(bU);bX=_.Concat(bV);return $.New(q.CreateElement(bT),bW,bX);};_.Radio=function(bT,bU,bV){var bW,bX;bW=q.CreateElement("input");bW.addEventListener("click",function(){return bV.Set(bU);},false);bX=_2.DynamicProp("checked",x.Map(function(bY){return bB.Equals(bY,bU);},bV.get_View()));return $.New(bW,W.Concat(br.append(br.ofArray([W.Create("type","radio"),W.Create("name",bV.get_Id()),bX]),br.ofSeq(bT))),_.Empty());};_.LinkView=function(bT,bU,bV,bW){var bX;bX=W.Concat(by.append([_2.HandlerView("click",bV,function(){return function(){return bW;};}),W.Create("href","#")],bU));return $.New(q.CreateElement("a"),bX,_.TextNode(bT));};_.Link=function(bT,bU,bV){var bW,bX;bW=(bX=W.Concat(bU),W.Append(W.Create("href","#"),bX));return $.New(_.Clickable("a",bV),bW,_.TextNode(bT));};_.ButtonView=function(bT,bU,bV,bW){var bX;bX=W.Concat(by.append([_2.HandlerView("click",bV,function(){return function(){return bW;};})],bU));return $.New(q.CreateElement("button"),bX,_.TextNode(bT));};_.Button=function(bT,bU,bV){var bW;bW=W.Concat(bU);return $.New(_.Clickable("button",bV),bW,_.TextNode(bT));};_.Clickable=function(bT,bU){var bV;bV=q.CreateElement(bT);bV.addEventListener("click",function(bW){bW.preventDefault();return bU();},false);return bV;};_.CheckBoxGroup=function(bT,bU,bV){function bW(bX){return bB.Equals(bU,bX);}return _.CheckBox(bT,w.Lens(bV,function(bX){return br.exists(bW,bX);},function(bX,bY){return bY?br.exists(function(bZ){return bB.Equals(bU,bZ);},bX)?bX:new br.T({$:1,$0:bU,$1:bX}):br.filter(function(bZ){return!bB.Equals(bU,bZ);},bX);}));};_.CheckBox=function(bT,bU){return _.InputInternal("input",function(){return by.append(bT,[W.Create("type","checkbox"),_2.Checked(bU)]);});};_.SelectDynOptional=function(bT,bU,bV,bW,bX){return _.SelectDyn(bT,function(bY){return bY!=null&&bY.$==1?bV(bY.$0):bU;},x.Map(function(bY){return new br.T({$:1,$0:null,$1:br.map(function(bZ){return{$:1,$0:bZ};},bY)});},bW),bX);};_.SelectOptional=function(bT,bU,bV,bW,bX){return _.Select(bT,function(bY){return bY!=null&&bY.$==1?bV(bY.$0):bU;},new br.T({$:1,$0:null,$1:br.map(function(bY){return{$:1,$0:bY};},bW)}),bX);};_.Select=function(bT,bU,bV,bW){return _.SelectImpl(bT,bU,function(bX){bX[0]=bV;return _.Concat(br.mapi(function(bY,bZ){return _.Element("option",br.ofArray([W.Create("value",a.String(bY))]),br.ofArray([_.TextNode(bU(bZ))]));},bV));},bW);};_.SelectDyn=function(bT,bU,bV,bW){return _.SelectImpl(bT,bU,function(bX){function bY(bZ,b0){return _.Element("option",br.ofArray([W.Create("value",a.String(bZ))]),br.ofArray([_.TextNode(bU(b0))]));}return _.Convert(function(bZ){return bY(bZ[0],bZ[1]);},x.Map(function(bZ){bX[0]=bZ;return by.mapi(function(b0,b1){return[b0,b1];},bZ);},bV));},bW);};_.SelectImpl=function(bT,bU,bV,bW){var bX,bY,bZ,b0;function b1(b6){return b6.selectedIndex;}function b2(b6,b7){b6.selectedIndex=b7;}function b3(b6){var b7;b7=b1(b6);return bX[0].get_Item(b7);}function b4(b6){return by.findIndex(function(b7){return bB.Equals(b6,b7);},bX[0]);}function b5(b6,b7){return b2(b6,b4(b7));}bX=[br.T.Empty];bY=q.CreateElement("select");bZ=_2.DynamicCustom(function(b6){return function(b7){return b5(b6,b7);};},bW.get_View());bY.addEventListener("change",function(){bW.UpdateMaybe(function(b6){var b7;b7=b3(bY);return bB.Equals(b6,b7)?null:{$:1,$0:b7};});},false);return $.New(bY,(b0=W.Append(bZ,W.Concat(bT)),W.Append(_2.OnAfterRender(function(b6){b5(b6,bW.Get());}),b0)),bV(bX));};_.InputArea=function(bT,bU){return _.InputInternal("textarea",function(){return by.append(bT,[_2.Value(bU)]);});};_.FloatInput=function(bT,bU){return _.InputInternal("input",function(){return by.append(bT,[_2.FloatValue(bU),W.Create("type","number")]);});};_.FloatInputUnchecked=function(bT,bU){return _.InputInternal("input",function(){return by.append(bT,[bU.Get()===0?W.Create("value","0"):_0.EmptyAttr(),_2.FloatValueUnchecked(bU),W.Create("type","number")]);});};_.IntInput=function(bT,bU){return _.InputInternal("input",function(){return by.append(bT,[_2.IntValue(bU),W.Create("type","number")]);});};_.IntInputUnchecked=function(bT,bU){return _.InputInternal("input",function(){return by.append(bT,[bU.Get()===0?W.Create("value","0"):_0.EmptyAttr(),_2.IntValueUnchecked(bU),W.Create("type","number")]);});};_.PasswordBox=function(bT,bU){return _.InputInternal("input",function(){return by.append(bT,[_2.Value(bU),W.Create("type","password")]);});};_.Input=function(bT,bU){return _.InputInternal("input",function(){return by.append(bT,[_2.Value(bU)]);});};_.InputInternal=function(bT,bU){var bV;bV=q.CreateElement(bT);return $.New(bV,W.Concat(bU(bV)),_.Empty());};_.ConvertSeqBy=function(bT,bU,bV){return _.Flatten(x.MapSeqCachedViewBy(bT,function(bW,bX){return(bU(bW))(bX);},bV));};_.ConvertSeq=function(bT,bU){return _.Flatten(x.MapSeqCachedView(bT,bU));};_.ConvertBy=function(bT,bU,bV){return _.Flatten(x.MapSeqCachedBy(bT,bU,bV));};_.Convert=function(bT,bU){return _.Flatten(x.MapSeqCached(bT,bU));};_.Flatten=function(bT){return _.EmbedView(x.Map(_.Concat,bT));};_.GetOrLoadTemplate=function(bT,bU,bV,bW){_.LoadLocalTemplates$1();_.PrepareTemplate(bT,bU,bV);return _.NamedTemplate(bT,bU,bW);};_.NamedTemplate=function(bT,bU,bV){var bW,bX;bW=(bX=null,[_9.LoadedTemplateFile(bT).TryGetValue(bU==null?"":bU.$0,{get:function(){return bX;},set:function(bY){bX=bY;}}),bX]);return bW[0]?_.ChildrenTemplate(bW[1].cloneNode(true),bV):(bC.warn("Local template doesn't exist",bU),_.Empty());};_.LoadLocalTemplates=function(bT){var bU;bU=_9.LoadedTemplateFile("");bU.count>0?_9.LoadedTemplates().set_Item(bT,bU):(function(){var bV,bW,bX,bY;while(true){bV=a.document.querySelector("[ws-template]");if(bB.Equals(bV,null)){bW=a.document.querySelector("[ws-children-template]");if(bB.Equals(bW,null))return null;else{bX=bW.getAttribute("ws-children-template");bW.removeAttribute("ws-children-template");_.PrepareTemplate(bT,{$:1,$0:bX},function(bZ){return function(){return q.ChildrenArray(bZ);};}(bW));}}else{bY=bV.getAttribute("ws-template");_.PrepareSingleTemplate(bT,{$:1,$0:bY},bV);}}}(),_9.LoadedTemplates().set_Item("",_9.LoadedTemplateFile(bT)));};_.LoadLocalTemplates$1=function(){if(!_9.LocalTemplatesLoaded()){_9.set_LocalTemplatesLoaded(true);_.LoadLocalTemplates("");}};_.PrepareTemplate=function(bT,bU,bV){var bW,bX,bY,bZ,b0;if(!_9.LoadedTemplateFile(bT).ContainsKey(bU==null?"":bU.$0)){bW=bV();for(bX=0,bY=bW.length-1;bX<=bY;bX++){bZ=bs.get(bW,bX);b0=bZ.parentNode;bB.Equals(b0,null)?void 0:b0.removeChild(bZ);}_.PrepareTemplateStrict(bT,bU,bW);}};_.PrepareTemplateStrict=function(bT,bU,bV){var bW,bX;function bY(b_){var ca,cb,cc,cd,ce,cf,cg,ch;function b$(ci){var cj;cj=b_.getAttribute(ci);cj===null?void 0:b_.setAttribute(ci,cj.toLowerCase());}ca=b_.attributes;cb=[];cc=[];cd=[];for(ce=0,cf=ca.length-1;ce<=cf;ce++){cg=ca.item(ce);bu.StartsWith(cg.nodeName,"ws-on")&&cg.nodeName!=="ws-onafterrender"&&cg.nodeName!=="ws-on"?(cb.push(cg.nodeName),cc.push(bO.string(cg.nodeName,{$:1,$0:"ws-on".length},null)+":"+cg.nodeValue.toLowerCase())):!bu.StartsWith(cg.nodeName,"ws-")&&(new a.RegExp(_9.TextHoleRE())).test(cg.nodeValue)?(cg.nodeValue=(ch=new a.RegExp(_9.TextHoleRE(),"g"),cg.nodeValue.replace(ch,function(ci,cj){return"${"+cj.toLowerCase()+"}";})),cd.push(cg.nodeName)):void 0;}!(cc.length==0)?b_.setAttribute("ws-on",bu.concat(" ",cc)):void 0;!(cd.length==0)?b_.setAttribute("ws-attr-holes",bu.concat(" ",cd)):void 0;b$("ws-hole");b$("ws-replace");b$("ws-attr");b$("ws-onafterrender");b$("ws-var");bs.iter(function(ci){b_.removeAttribute(ci);},cb);}function bZ(b_){var b$,ca,cb,cc,cd,ce;b$=null;ca=0;cc=b_.textContent;cd=new a.RegExp(_9.TextHoleRE(),"g");while(b$=cd.exec(cc),b$!==null){b_.parentNode.insertBefore(a.document.createTextNode(bO.string(cc,{$:1,$0:ca},{$:1,$0:cd.lastIndex-bs.get(b$,0).length-1})),b_);ca=cd.lastIndex;ce=a.document.createElement("span");ce.setAttribute("ws-replace",bs.get(b$,1).toLowerCase());b_.parentNode.insertBefore(ce,b_);}cd.lastIndex=0;b_.textContent=bO.string(cc,{$:1,$0:ca},null);}function b0(b_,b$){function ca(cb){q.IterSelector(b_,"["+cb+"]",function(cc){var cd,ce;cd=(ce=null,[b$.TryGetValue(cc.getAttribute(cb).toLowerCase(),{get:function(){return ce;},set:function(cf){ce=cf;}}),ce]);cd[0]?cc.setAttribute(cb,cd[1]):void 0;});}ca("ws-hole");ca("ws-replace");ca("ws-attr");ca("ws-onafterrender");ca("ws-var");q.IterSelector(b_,"[ws-on]",function(cb){cb.setAttribute("ws-on",bu.concat(" ",bs.map(function(cc){var cd,ce,cf;cd=bu.SplitChars(cc,[":"],1);ce=(cf=null,[b$.TryGetValue(bs.get(cd,1),{get:function(){return cf;},set:function(cg){cf=cg;}}),cf]);return ce[0]?bs.get(cd,0)+":"+ce[1]:cc;},bu.SplitChars(cb.getAttribute("ws-on"),[" "],1))));});return q.IterSelector(b_,"[ws-attr-holes]",function(cb){var cc,cd,ce;cc=bu.SplitChars(cb.getAttribute("ws-attr-holes"),[" "],1);for(cd=0,ce=cc.length-1;cd<=ce;cd++)(function(){var cf;function cg(ch,ci){var cj;cj=bG.KeyValue(ci);return ch.replace(new a.RegExp("\\${"+cj[0]+"}","ig"),"${"+cj[1]+"}");}cf=bs.get(cc,cd);return cb.setAttribute(cf,(((bA.Curried3(by.fold))(cg))(cb.getAttribute(cf)))(b$));}());});}function b1(b_,b$){var ca,cb,cc,cd,ce;bY(b$);ca=b$.nodeName.toLowerCase();cb=b_.querySelector("[ws-attr="+ca+"]");if(bB.Equals(cb,null))return bC.warn("Filling non-existent attr hole",ca);else{cb.removeAttribute("ws-attr");for(cc=0,cd=b$.attributes.length-1;cc<=cd;cc++){ce=b$.attributes.item(cc);ce.name==="class"&&cb.hasAttribute("class")?cb.setAttribute("class",cb.getAttribute("class")+" "+ce.nodeValue):cb.setAttribute(ce.name,ce.nodeValue);}return;}}function b2(b_,b$){function ca(cb){q.IterSelector(b_,"["+cb+"]",function(cc){if(!b$.Contains(cc.getAttribute(cb)))cc.removeAttribute(cb);});}ca("ws-attr");ca("ws-onafterrender");ca("ws-var");q.IterSelector(b_,"[ws-hole]",function(cb){if(!b$.Contains(cb.getAttribute("ws-hole"))){cb.removeAttribute("ws-hole");while(cb.hasChildNodes())cb.removeChild(cb.lastChild);}});q.IterSelector(b_,"[ws-replace]",function(cb){if(!b$.Contains(cb.getAttribute("ws-replace")))cb.parentNode.removeChild(cb);});q.IterSelector(b_,"[ws-on]",function(cb){cb.setAttribute("ws-on",bu.concat(" ",bs.filter(function(cc){return b$.Contains(bs.get(bu.SplitChars(cc,[":"],1),1));},bu.SplitChars(cb.getAttribute("ws-on"),[" "],1))));});return q.IterSelector(b_,"[ws-attr-holes]",function(cb){var cc,cd,ce,cf,cg;cc=bu.SplitChars(cb.getAttribute("ws-attr-holes"),[" "],1);for(cd=0,ce=cc.length-1;cd<=ce;cd++){cf=bs.get(cc,cd);cb.setAttribute(cf,(cg=new a.RegExp(_9.TextHoleRE(),"g"),cb.getAttribute(cf).replace(cg,function(ch,ci){return b$.Contains(ci)?ch:"";})));}});}function b3(b_,b$){var ca;ca=b_.querySelector("[ws-replace]");return bB.Equals(ca,null)?(bC.warn("Filling non-existent text hole",bU),null):(ca.parentNode.replaceChild(new a.Text(b$),ca),{$:1,$0:ca.getAttribute("ws-replace")});}function b4(b_,b$,ca){while(true)if(b_.hasChildNodes())ca=b$.insertBefore(b_.lastChild,ca);else return null;}function b5(b_,b$,ca){var cb,cc,cd,ce,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB;function cf(cC){}while(true)switch(b_){case 0:cg=bO.string(b$.nodeName,{$:1,$0:3},null).toLowerCase();ch=(cb=cg.indexOf("."),cb===-1?[bT,cg]:[bO.string(cg,null,{$:1,$0:cb-1}),bO.string(cg,{$:1,$0:cb+1},null)]);ci=ch[1];cj=ch[0];if(!_9.LoadedTemplates().ContainsKey(cj))return bC.warn("Instantiating non-loaded template",ci);else{ck=_9.LoadedTemplates().get_Item(cj);if(!ck.ContainsKey(ci))return bC.warn("Instantiating non-loaded template",ci);else{cl=ck.get_Item(ci);cm=cl.cloneNode(true);cn=new bx.New$3();co=new bJ.New$5();cp=b$.attributes;for(cq=0,cr=cp.length-1;cq<=cr;cq++){cs=cp.item(cq).name.toLowerCase();co.set_Item(cs,(ct=cp.item(cq).nodeValue,ct===""?cs:ct.toLowerCase()));!cn.Add(cs)?bC.warn("Hole mapped twice",cs):void 0;}for(cu=0,cv=b$.childNodes.length-1;cu<=cv;cu++){cw=b$.childNodes[cu];bB.Equals(cw.nodeType,bM.ELEMENT_NODE)?!cn.Add(cw.nodeName.toLowerCase())?bC.warn("Hole filled twice",ci):void 0:void 0;}cx=b$.childNodes.length===1&&bB.Equals(b$.firstChild.nodeType,bM.TEXT_NODE);if(cx){cd=b3(cm,b$.firstChild.textContent);((function(cC){return function(cD){if(cD!=null)cC(cD.$0);};}((ce=function(cC){return function(cD){return cC.Add(cD);};}(cn),function(cC){return cf(ce(cC));})))(cd));}b2(cm,cn);if(!cx){for(cy=0,cz=b$.childNodes.length-1;cy<=cz;cy++){cA=b$.childNodes[cy];bB.Equals(cA.nodeType,bM.ELEMENT_NODE)?cA.hasAttributes()?b1(cm,cA):b6(cm,cA):void 0;}}b0(cm,co);(((function(cC){function cD(cE,cF){return b4(cC,cE,cF);}return function(cE){return function(cF){return cD(cE,cF);};};}(cm))(b$.parentNode))(b$));b$.parentNode.removeChild(b$);return;}}break;case 1:if(ca!==null){cB=ca.nextSibling;if(bB.Equals(ca.nodeType,bM.TEXT_NODE))bZ(ca);else if(bB.Equals(ca.nodeType,bM.ELEMENT_NODE))b8(ca);ca=cB;}else return null;break;}}function b6(b_,b$){var ca,cc,cd;function cb(ce,cf){var cg,ch,ci;if(cc==="title"&&b$.hasChildNodes()){cg=bN.parseHTML(b$.textContent);b$.removeChild(b$.firstChild);for(ch=0,ci=cg.length-1;ch<=ci;ch++)b$.appendChild(bs.get(cg,ch));}else null;b8(b$);return b4(b$,ce,cf);}cc=b$.nodeName.toLowerCase();q.IterSelector(b_,"[ws-attr-holes]",function(ce){var cf,cg,ch,ci,cj;cf=bu.SplitChars(ce.getAttribute("ws-attr-holes"),[" "],1);for(cg=0,ch=cf.length-1;cg<=ch;cg++){ci=bs.get(cf,cg);ce.setAttribute(ci,(cj=new a.RegExp("\\${"+cc+"}","ig"),ce.getAttribute(ci).replace(cj,b$.textContent)));}});cd=b_.querySelector("[ws-hole="+cc+"]");if(bB.Equals(cd,null)){ca=b_.querySelector("[ws-replace="+cc+"]");return bB.Equals(ca,null)?null:(cb(ca.parentNode,ca),void ca.parentNode.removeChild(ca));}else{while(cd.hasChildNodes())cd.removeChild(cd.lastChild);cd.removeAttribute("ws-hole");return cb(cd,null);}}function b7(b_){return b5(0,b_);}function b8(b_){var b$,ca;if(bu.StartsWith(b_.nodeName.toLowerCase(),"ws-")&&!b_.hasAttribute("ws-template"))b7(b_);else{bY(b_);b$=b_.getAttribute("ws-template");if(b$===null){ca=b_.getAttribute("ws-children-template");if(ca===null)b9(b_,b_.firstChild);else{b_.removeAttribute("ws-children-template");_.PrepareTemplate(bT,{$:1,$0:ca},function(){return q.ChildrenArray(b_);});while(b_.hasChildNodes())b_.removeChild(b_.lastChild);}}else _.PrepareSingleTemplate(bT,{$:1,$0:b$},b_);}}function b9(b_,b$){return b5(1,b_,b$);}bW=_.FakeRoot(bV);bX=(bU==null?"":bU.$0).toLowerCase();_9.LoadedTemplateFile(bT).set_Item(bX,bW);bs.length(bV)>0?b9(bW,bs.get(bV,0)):void 0;};_.ComposeName=function(bT,bU){return(bT+"/"+(bU==null?"":bU.$0)).toLowerCase();};_.PrepareSingleTemplate=function(bT,bU,bV){var bW,bX,bY;bV.removeAttribute("ws-template");bW=bV.getAttribute("ws-replace");bW===null?void 0:(bV.removeAttribute("ws-replace"),bX=bV.parentNode,bB.Equals(bX,null)?void 0:(bY=a.document.createElement(bV.tagName),bY.setAttribute("ws-replace",bW),bX.replaceChild(bY,bV)));_.PrepareTemplateStrict(bT,bU,[bV]);};_.FakeRoot=function(bT){var bU,bV,bW;bU=a.document.createElement("div");for(bV=0,bW=bT.length-1;bV<=bW;bV++)bU.appendChild(bs.get(bT,bV));return bU;};_.ChildrenTemplate=function(bT,bU){var bV,bW,bX,bY,bZ,b2,b3,b4,b5,b6,b7,b8;function b0(b9,b_){var b$,ca,cb;b$=_0.Insert(b9,b_);b3.push(_0.Updates(b$));b4.push([b9,b$]);ca=bA.GetOptional(b$.OnAfterRender);return ca==null?null:(cb=ca.$0,void b5.push(function(){cb(b9);}));}function b1(b9){var b_,b$;b_=(b$=null,[b6.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);return b_[0]?b_[1].$==0?{$:1,$0:b_[1].$1}:b_[1].$==1?{$:1,$0:_.TextNode(b_[1].$1)}:b_[1].$==2?{$:1,$0:_.TextView(b_[1].$1)}:b_[1].$==7?{$:1,$0:_.TextView(b_[1].$1.get_View())}:b_[1].$==8?{$:1,$0:_.TextView(x.Map(a.String,b_[1].$1.get_View()))}:b_[1].$==9?{$:1,$0:_.TextView(x.Map(function(ca){return ca.get_Input();},b_[1].$1.get_View()))}:b_[1].$==10?{$:1,$0:_.TextView(x.Map(a.String,b_[1].$1.get_View()))}:b_[1].$==11?{$:1,$0:_.TextView(x.Map(function(ca){return ca.get_Input();},b_[1].$1.get_View()))}:b_[1].$==12?{$:1,$0:_.TextView(x.Map(a.String,b_[1].$1.get_View()))}:(bC.warn("Content hole filled with attribute data",b9),null):null;}b2=[];b3=[];b4=[];b5=[];b6=new bJ.New$5();b7=bt.Get(bU);try{while(b7.MoveNext()){b8=b7.Current();b6.set_Item(b8.$0,b8);}}finally{if("Dispose"in b7)b7.Dispose();}bV=q.ChildrenArray(bT);q.IterSelector(bT,"[ws-hole]",function(b9){var b_,b$,ca;ca=b9.getAttribute("ws-hole");b9.removeAttribute("ws-hole");while(b9.hasChildNodes())b9.removeChild(b9.lastChild);b_=b1(ca);b_!=null&&b_.$==1?(b$=b_.$0,_9.LinkElement(b9,b$.docNode),b2.push(_4.New(_0.Empty(b9),b$.docNode,null,b9,g.Int(),null)),b3.push(b$.updates)):void 0;});q.IterSelector(bT,"[ws-replace]",function(b9){var b_,b$,ca,cb,cc,cd;b_=b1(b9.getAttribute("ws-replace"));b_!=null&&b_.$==1?(b$=b_.$0,ca=b9.parentNode,cb=a.document.createTextNode(""),ca.replaceChild(cb,b9),cc=_9.InsertBeforeDelim(cb,b$.docNode),cd=bs.tryFindIndex(function(ce){return b9===ce;},bV),cd==null?void 0:bs.set(bV,cd.$0,b$.docNode),b2.push(_4.New(_0.Empty(ca),b$.docNode,{$:1,$0:[cc,cb]},ca,g.Int(),null)),b3.push(b$.updates)):void 0;});q.IterSelector(bT,"[ws-attr]",function(b9){var b_,b$,ca;b_=b9.getAttribute("ws-attr");b9.removeAttribute("ws-attr");b$=(ca=null,[b6.TryGetValue(b_,{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);b$[0]?b$[1].$==3?b0(b9,b$[1].$1):bC.warn("Attribute hole filled with non-attribute data",b_):void 0;});q.IterSelector(bT,"[ws-on]",function(b9){b0(b9,W.Concat(bs.choose(function(b_){var b$,ca,cb;b$=bu.SplitChars(b_,[":"],1);ca=(cb=null,[b6.TryGetValue(bs.get(b$,1),{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);return ca[0]?ca[1].$==4?{$:1,$0:_2.Handler(bs.get(b$,0),ca[1].$1)}:ca[1].$==5?{$:1,$0:W.Handler(bs.get(b$,0),ca[1].$2)}:(bC.warn("Event hole on"+bs.get(b$,0)+" filled with non-event data",bs.get(b$,1)),null):null;},bu.SplitChars(b9.getAttribute("ws-on"),[" "],1))));b9.removeAttribute("ws-on");});q.IterSelector(bT,"[ws-onafterrender]",function(b9){var b_,b$,ca;b_=b9.getAttribute("ws-onafterrender");b$=(ca=null,[b6.TryGetValue(b_,{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);b$[0]?b$[1].$==6?(b9.removeAttribute("ws-onafterrender"),b0(b9,_2.OnAfterRender(b$[1].$1))):bC.warn("onafterrender hole filled with non-onafterrender data",b_):void 0;});q.IterSelector(bT,"[ws-var]",function(b9){var b_,b$,ca;b_=b9.getAttribute("ws-var");b9.removeAttribute("ws-var");b$=(ca=null,[b6.TryGetValue(b_,{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);b$[0]?b$[1].$==7?b0(b9,_2.Value(b$[1].$1)):b$[1].$==8?b0(b9,_2.Checked(b$[1].$1)):b$[1].$==9?b0(b9,_2.IntValue(b$[1].$1)):b$[1].$==10?b0(b9,_2.IntValueUnchecked(b$[1].$1)):b$[1].$==11?b0(b9,_2.FloatValue(b$[1].$1)):b$[1].$==12?b0(b9,_2.FloatValueUnchecked(b$[1].$1)):bC.warn("Var hole filled with non-Var data",b_):void 0;});q.IterSelector(bT,"[ws-attr-holes]",function(b9){var b_,b$,ca,cb;b_=new a.RegExp(_9.TextHoleRE(),"g");b$=bu.SplitChars(b9.getAttribute("ws-attr-holes"),[" "],1);b9.removeAttribute("ws-attr-holes");for(ca=0,cb=b$.length-1;ca<=cb;ca++)(function(){var cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co;cl=bs.get(b$,ca);cm=b9.getAttribute(cl);cc=null;cd=0;cn=[];while(cc=b_.exec(cm),cc!==null){co=bO.string(cm,{$:1,$0:cd},{$:1,$0:b_.lastIndex-bs.get(cc,0).length-1});cd=b_.lastIndex;cn.push([co,bs.get(cc,1)]);}cf=bO.string(cm,{$:1,$0:cd},null);b_.lastIndex=0;cg=bs.foldBack(function(cp,cq){return(function(cr){var cs,ct;cs=cr[0];ct=cr[1];return function(cu){var cv,cw,cx,cy,cz;cv=cu[0];cw=cu[1];cx=(cy=(cz=null,[b6.TryGetValue(ct,{get:function(){return cz;},set:function(cA){cz=cA;}}),cz]),cy[0]?cy[1].$==1?{$:0,$0:cy[1].$1}:cy[1].$==2?{$:1,$0:cy[1].$1}:cy[1].$==7?{$:1,$0:cy[1].$1.get_View()}:cy[1].$==8?{$:1,$0:x.Map(a.String,cy[1].$1.get_View())}:cy[1].$==9?{$:1,$0:x.Map(function(cA){return cA.get_Input();},cy[1].$1.get_View())}:cy[1].$==10?{$:1,$0:x.Map(a.String,cy[1].$1.get_View())}:cy[1].$==11?{$:1,$0:x.Map(function(cA){return cA.get_Input();},cy[1].$1.get_View())}:cy[1].$==12?{$:1,$0:x.Map(a.String,cy[1].$1.get_View())}:(bC.warn("Attribute value hole filled with non-text data",ct),{$:0,$0:""}):{$:0,$0:""});return cx.$==1?[cs,new br.T({$:1,$0:cv===""?cx.$0:x.Map(function(cA){return cA+cv;},cx.$0),$1:cw})]:[cs+cx.$0+cv,cw];};}(cp))(cq);},cn,[cf,br.T.Empty]);return b0(b9,cg[1].$==1?cg[1].$1.$==1?cg[1].$1.$1.$==1?cg[1].$1.$1.$1.$==0?(ch=cg[0],_2.Dynamic(cl,x.Map3(function(cp,cq,cr){return ch+cp+cq+cr;},cg[1].$0,cg[1].$1.$0,cg[1].$1.$1.$0))):(ci=cg[0],_2.Dynamic(cl,x.Map(function(cp){return ci+bu.concat("",cp);},x.Sequence(cg[1])))):(cj=cg[0],_2.Dynamic(cl,x.Map2(function(cp,cq){return cj+cp+cq;},cg[1].$0,cg[1].$1.$0))):cg[0]===""?_2.Dynamic(cl,cg[1].$0):(ck=cg[0],_2.Dynamic(cl,x.Map(function(cp){return ck+cp;},cg[1].$0))):W.Create(cl,cg[0]));}());});bW=bA.DeleteEmptyFields({Els:bV,Dirty:true,Holes:b2,Attrs:b4,Render:(bX=b5.length==0?null:{$:1,$0:function(b9){bs.iter(function(b_){b_(b9);},b5);}},bX?bX.$0:void 0)},["Render"]);bY=d.TreeReduce(x.Const(),x.Map2Unit,b3);return bV&&bs.length(bV)===1&&(bs.get(bV,0)instanceof bM&&(bB.Equals(bs.get(bV,0).nodeType,bM.ELEMENT_NODE)&&(bZ=bs.get(bV,0),true)))?$.TreeNode(bW,bY):_.Mk({$:6,$0:bW},bY);};_.Template=function(bT,bU){return _.ChildrenTemplate(_.FakeRoot(bT),bU);};_.TextView=function(bT){var bU;bU=_9.CreateTextNode();return _.Mk({$:4,$0:bU},x.Map(function(bV){_9.UpdateTextNode(bU,bV);},bT));};_.RunReplaceById=function(bT,bU){var bV;bV=q.Doc().getElementById(bT);bB.Equals(bV,null)?bG.FailWith("invalid id: "+bT):bU.ReplaceInDom(bV);};_.RunById=function(bT,bU){var bV;bV=q.Doc().getElementById(bT);bB.Equals(bV,null)?bG.FailWith("invalid id: "+bT):_.Run(bV,bU);};_.Run=function(bT,bU){var bV;_.LoadLocalTemplates$1();bV=bU.docNode;_9.LinkElement(bT,bV);x.Sink(m.StartProcessor(_9.PerformAnimatedUpdate(_9.CreateRunState(bT,bV),bV)),bU.updates);};_.RunPrependById=function(bT,bU){var bV;bV=q.Doc().getElementById(bT);bB.Equals(bV,null)?bG.FailWith("invalid id: "+bT):_.RunPrepend(bV,bU);};_.RunPrepend=function(bT,bU){var bV;bV=a.document.createTextNode("");bT.insertBefore(bV,bT.firstChild);_.RunBefore(bV,bU);};_.RunAppendById=function(bT,bU){var bV;bV=q.Doc().getElementById(bT);bB.Equals(bV,null)?bG.FailWith("invalid id: "+bT):_.RunAppend(bV,bU);};_.RunAppend=function(bT,bU){var bV;bV=a.document.createTextNode("");bT.appendChild(bV);_.RunBefore(bV,bU);};_.RunAfterById=function(bT,bU){var bV;bV=q.Doc().getElementById(bT);bB.Equals(bV,null)?bG.FailWith("invalid id: "+bT):_.RunAfter(bV,bU);};_.RunAfter=function(bT,bU){var bV;bV=a.document.createTextNode("");bT.parentNode.insertBefore(bV,bT.nextSibling);_.RunBetween(bT,bV,bU);};_.RunBeforeById=function(bT,bU){var bV;bV=q.Doc().getElementById(bT);bB.Equals(bV,null)?bG.FailWith("invalid id: "+bT):_.RunBefore(bV,bU);};_.RunBefore=function(bT,bU){var bV;bV=a.document.createTextNode("");bT.parentNode.insertBefore(bV,bT);_.RunBetween(bV,bT,bU);};_.RunBetween=function(bT,bU,bV){_9.LinkPrevElement(bU,bV.docNode);x.Sink(m.StartProcessor(_9.PerformAnimatedUpdate(_9.CreateDelimitedRunState(bT,bU,bV.docNode),bV.docNode)),bV.updates);};_.Async=function(bT){return _.EmbedView(x.MapAsync(a.id,x.Const(bT)));};_.BindView=function(bT,bU){return _.EmbedView(x.Map(bT,bU));};_.EmbedView=function(bT){var bU;bU=_9.CreateEmbedNode();return _.Mk({$:2,$0:bU},x.Map(a.ignore,x.Bind(function(bV){_9.UpdateEmbedNode(bU,bV.docNode);return bV.updates;},bT)));};_.Static=function(bT){return $.New(bT,_0.EmptyAttr(),_.Empty());};_.Mk=function(bT,bU){return new _.New(bT,bU);};_.New=bA.Ctor(function(bT,bU){this.docNode=bT;this.updates=bU;},_);$=c.Elt=bA.Class({AddClass:function(bT){return this.elt.className+=" "+bT;},ClearHoles:function(){var bT;bT=this.docNode$1;bT!=null&&bT.$==6?bT.$0.Holes=[]:void 0;},AddHole:function(bT){var bU;bU=this.docNode$1;bU!=null&&bU.$==6?bU.$0.Holes.push(bT):void 0;},SetStyle:function(bT,bU){this.elt.style[bT]=bU;},HasClass:function(bT){return(new a.RegExp("(\\s|^)"+bT+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bT){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bT+")+(\\s|$)","g"),"$1");},GetProperty:function(bT){return this.elt[bT];},SetProperty:function(bT,bU){this.elt[bT]=bU;},RemoveAttribute:function(bT){this.elt.removeAttribute(bT);},HasAttribute:function(bT){return this.elt.hasAttribute(bT);},GetAttribute:function(bT){return this.elt.getAttribute(bT);},SetAttribute:function(bT,bU){this.elt.setAttribute(bT,bU);},SetText:function(bT){var bU;bU=this.docNode$1;bU!=null&&bU.$==1?bU.$0.Children=null:bU!=null&&bU.$==6?(bU.$0.Els=[],this.ClearHoles()):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(x.Const());this.elt.textContent=bT;},GetText:function(){return this.elt.textContent;},SetValue:function(bT){this.elt.value=bT;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bT;bT=this.docNode$1;bT!=null&&bT.$==1?bT.$0.Children=null:bT!=null&&bT.$==6?(bT.$0.Els=[],this.ClearHoles()):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(x.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bT){var bU,bV,bW,bX,bY;bU=this.docNode$1;bU!=null&&bU.$==1?(bV=bU.$0,bV.Children={$:0,$0:bT.docNode,$1:bV.Children},_9.InsertDoc(this.elt,bT.docNode,(bW=this.elt.firstChild,bB.Equals(bW,null)?null:bW))):bU!=null&&bU.$==6?(bX=this.elt.insertBefore(a.document.createTextNode(""),this.elt.firstChild),bY=_9.InsertBeforeDelim(bX,bT.docNode),this.AddHole(_4.New(_0.Empty(this.elt),bT.docNode,{$:1,$0:[bY,bX]},this.elt,g.Int(),null))):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(x.Map2Unit(this.rvUpdates.c,bT.updates));},Append:function(bT){var bU,bV,bW,bX;bU=this.docNode$1;bU!=null&&bU.$==1?(bV=bU.$0,bV.Children={$:0,$0:bV.Children,$1:bT.docNode},_9.InsertDoc(this.elt,bT.docNode,null)):bU!=null&&bU.$==6?(bW=this.elt.appendChild(a.document.createTextNode("")),bX=_9.InsertBeforeDelim(bW,bT.docNode),this.AddHole(_4.New(_0.Empty(this.elt),bT.docNode,{$:1,$0:[bX,bW]},this.elt,g.Int(),null))):bG.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(x.Map2Unit(this.rvUpdates.c,bT.updates));},ToUpdater:function(){var bT,bU;return new ba.New((bT=this.docNode$1,bT!=null&&bT.$==1?bA.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bT.$0.Attr]],Render:(bU=null,bU?bU.$0:void 0)},["Render"]):bT!=null&&bT.$==6?bT.$0:bG.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,w.Create$1([]));},OnAfterRenderView:function(bT,bU){var bV,bW;bV=this;bW=g.Id();this.Append(_.BindView(function(bX){bV.elt[bW]=bX;return _.Empty();},bT));return this.OnAfterRender(function(bX){bU(bX,bX[bW]);});},OnAfterRender:function(bT){var bU,bV,bW,bX,bY,bZ,b0;bU=this.docNode$1;bU!=null&&bU.$==1?(bV=bU.$0,bA.SetOptional(bV,"Render",(bW=bA.GetOptional(bV.Render),bW!=null&&bW.$==1?(bX=bW.$0,{$:1,$0:function(b1){bX(b1);bT(b1);}}):{$:1,$0:bT}))):bU!=null&&bU.$==6?(bY=bU.$0,bA.SetOptional(bY,"Render",(bZ=bA.GetOptional(bY.Render),bZ!=null&&bZ.$==1?(b0=bZ.$0,{$:1,$0:function(b1){b0(b1);bT(b1);}}):{$:1,$0:bT}))):bG.FailWith("Invalid docNode in Elt");return this;},onView:function(bT,bU,bV){var bW;bW=bV(this.elt);this.elt.addEventListener(bT,function(bX){return x.Get(bW(bX),bU);},false);return this;},on:function(bT,bU){this.elt.addEventListener(bT,function(bV){return bU(bV.target,bV);},false);return this;}},_,$);$.TreeNode=function(bT,bU){var bV,bW;function bX(bY){return bY[1];}bV=z.Create(bU);return new $.New$1({$:6,$0:bT},x.Map2Unit((bW=bs.map(function(bY){return _0.Updates(bX(bY));},bT.Attrs),d.TreeReduce(x.Const(),x.Map2Unit,bW)),bV.v),bs.get(bT.Els,0),bV);};$.New=function(bT,bU,bV){var bW,bX;bW=_9.CreateElemNode(bT,bU,bV.docNode);bX=z.Create(bV.updates);return new $.New$1({$:1,$0:bW},x.Map2Unit(_0.Updates(bW.Attr),bX.v),bT,bX);};$.New$1=bA.Ctor(function(bT,bU,bV,bW){_.New.call(this,bT,bU);this.docNode$1=bT;this.updates$1=bU;this.elt=bV;this.rvUpdates=bW;},$);ba=X.EltUpdater=bA.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(bT){var bU,bV;function bW(bX){return bX===bV?false:true;}bU=bT.docNode;bU!=null&&bU.$==1?(bV=bU.$0.ElKey,this.treeNode.Holes=bs.filter(function(bX){return bX.ElKey!==bV;},this.treeNode.Holes),this.holeUpdates.Set(bs.filter(function(bX){return bW(bX[0]);},this.holeUpdates.Get()))):bG.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bT){var bU,bV,bW;bU=bT.docNode;bU!=null&&bU.$==1?(bV=bU.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bV]),bW=this.holeUpdates.Get(),bW.push([bV.ElKey,bT.updates]),this.holeUpdates.Set(bW)):bG.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(bT){this.origHoles.push(bT);this.treeNode.Holes=this.treeNode.Holes.concat([bT]);}},$,ba);ba.New=bA.Ctor(function(bT,bU,bV,bW,bX){var bY,bZ,b0,b1;function b2(b3){return b3[1];}$.New$1.call(this,{$:6,$0:bT},x.Map2Unit(bU,(bY=bX.get_View(),x.BindInner((bZ=function(b3){return bs.map(b2,b3);},(b0=(b1=x.Const(),function(b3){return d.TreeReduce(b1,x.Map2Unit,b3);}),function(b3){return b0(bZ(b3));})),bY))),bV,bW);this.treeNode=bT;this.holeUpdates=bX;this.origHoles=this.treeNode.Holes;},ba);bb.$cctor=function(){bb.$cctor=a.ignore;bb.LoadedTemplates=new bJ.New$5();bb.LocalTemplatesLoaded=false;bb.TextHoleRE="\\${([^}]+)}";};bc=c.Flow=bA.Class({get_Render:function(){return this.render;}},j,bc);bc.New=bA.Ctor(function(bT){bc.New$1.call(this,function(bU){return function(bV){return w.Set(bU,bT(bV));};});},bc);bc.New$1=bA.Ctor(function(bT){this.render=bT;},bc);bc.get_Do=function(){return new bd.New();};bc.Static=function(bT){return new bc.New$1(function(bU){return function(bV){w.Set(bU,bT);return bV();};});};bc.Define=function(bT){return new bc.New(function(bU){return bT(function(bV){bU(bV);});});};bc.Embed=function(bT){var bU;bU=w.Create$1(_.Empty());((bT.get_Render())(bU))(a.ignore);return _.EmbedView(bU.get_View());};bc.Return=function(bT){return new bc.New$1(function(){return function(bU){return bU(bT);};});};bc.Bind=function(bT,bU){return new bc.New$1(function(bV){return function(bW){return((bT.get_Render())(bV))(function(bX){((bU(bX).get_Render())(bV))(bW);});};});};bc.Map=function(bT,bU){return new bc.New$1(function(bV){return function(bW){return((bU.get_Render())(bV))(function(bX){bW(bT(bX));});};});};bd=c.FlowBuilder=bA.Class({ReturnFrom:a.id,Return:function(bT){return bc.Return(bT);},Bind:function(bT,bU){return bc.Bind(bT,bU);}},j,bd);bd.New=bA.Ctor(function(){},bd);bf=be.attr=bA.Class({},j,bf);bf.New=bA.Ctor(function(){},bf);bg.InstallHash=function(bT,bU){var bV;function bW(bZ){return bQ.Parse(bU,bR.FromHash(bZ,{$:1,$0:true}));}function bX(){var bZ,b0;bZ=a.location.hash;b0=bW(bZ);return b0==null?((function(b1){return function(b2){return b1("Failed to parse route: "+bS.toSafe(b2));};}(function(b1){bC.log(b1);}))(bZ),bT):b0.$0;}function bY(bZ){if(!bB.Equals(bV.Get(),bZ))bV.Set(bZ);}bV=w.Create$1(bX());a.onpopstate=function(){return bY(bX());};a.onhashchange=function(){return bY(bX());};bN(a.document.body).click(function(bZ){var b0,b1,b2,b3;b0=bN(bZ.target).closest("a").toArray();return b0&&bs.length(b0)===1?(b1=bs.get(b0,0),b1.localName==="a"?(b2=b1.getAttribute("href"),!(b2==null)&&bu.StartsWith(b2,"#")?(b3=bW(b2),b3==null?null:(bY(b3.$0),bZ.preventDefault())):null):null):null;});x.Sink(function(bZ){var b0;if(!bB.Equals(bZ,bX())){b0=bQ.HashLink(bU,bZ);a.history.pushState(null,null,b0);}},bV.get_View());return bV;};bg.Install=function(bT,bU){var bV;function bW(bZ){return bQ.Parse(bU,bZ);}function bX(){var bZ,b0,b1;bZ=a.location;b0=bR.FromUrl(bZ.pathname+bZ.search,null);b1=bW(b0);return b1==null?((function(b2){return function(b3){return b2("Failed to parse route: "+bS.toSafe(b3));};}(function(b2){bC.log(b2);}))(b0.ToLink()),bT):b1.$0;}function bY(bZ){if(!bB.Equals(bV.Get(),bZ))bV.Set(bZ);}bV=w.Create$1(bX());a.onpopstate=function(){return bY(bX());};bN(a.document.body).click(function(bZ){var b0,b1,b2,b3;b0=bN(bZ.target).closest("a").toArray();return b0&&bs.length(b0)===1?(b1=bs.get(b0,0),b1.localName==="a"?(b2=b1.getAttribute("href"),!(b2==null)?(b3=bW(bR.FromUrl(b2,null)),b3==null?null:(bY(b3.$0),bZ.preventDefault())):null):null):null;});x.Sink(function(bZ){var b0;if(!bB.Equals(bZ,bX())){b0=bQ.Link(bU,bZ);a.history.pushState(null,null,b0);}},bV.get_View());return bV;};bh.Append=function(bT,bU){return{$:0,$0:o.Append(bT.$0,bU.$0),$1:bE.FoldBack(function(bV,bW,bX){return bX.Add(bV,bW);},bT.$1,bU.$1)};};bh.FromList=function(bT,bU){return{$:0,$0:o.FromArray(bs.ofList(bT)),$1:bU};};bh.ToList=function(bT){return[br.ofArray(o.ToArray(bT.$0)),bT.$1];};bh.SameHash=function(bT,bU){return bh.NoHash(bT)===bh.NoHash(bU);};bh.MakeHash=function(bT){var bU,bV;bU=bT.$1;bV=bu.concat("/",bs.map(function(bW){return a.encodeURIComponent(bW);},o.ToArray(bT.$0)));return bU.get_IsEmpty()?bV:bV+"?"+bu.concat("&",by.map(function(bW){var bX;bX=bG.KeyValue(bW);return a.encodeURIComponent(bX[0])+"="+a.encodeURIComponent(bX[1]);},bU));};bh.ParseHash=function(bT){var bU,bV,bW,bX;bU=bh.NoHash(bT);bV=(bW=bU.indexOf("?"),bW===-1?[bU,""]:[bO.string(bU,null,{$:1,$0:bW-1}),bO.string(bU,{$:1,$0:bW+1},null)]);bX=bV[0];return{$:0,$0:o.FromArray(bX===""?[]:bs.map(function(bY){return a.decodeURIComponent(bY);},bu.SplitChars(bX,["/"],0))),$1:bE.OfArray(bs.map(function(bY){var bZ;bZ=bY.indexOf("=");return bZ===-1?[a.decodeURIComponent(bY),""]:[a.decodeURIComponent(bO.string(bY,null,{$:1,$0:bZ-1})),a.decodeURIComponent(bO.string(bY,{$:1,$0:bZ+1},null))];},bu.SplitChars(bV[1],["&"],0)))};};bh.NoHash=function(bT){return bu.StartsWith(bT,"#")?bT.substring(1):bT;};bi.DoLink=function(bT,bU){var bV;bV=bT.Ser(bU);return bh.FromList(bV[0],bV[1]);};bi.DoRoute=function(bT,bU){return bT.Des(bh.ToList(bU));};bi.InstallMap=function(bT){var bU;function bV(bZ,b0){return bB.Equals(bT.Ser(bZ),bT.Ser(b0));}function bW(){return bT.Des(bh.ToList(bh.ParseHash(a.location.hash)));}function bX(bZ){if(!bV(bU.Get(),bZ))bU.Set(bZ);}function bY(bZ){return bX(bW());}bU=w.Create$1(bW());a.onpopstate=bY;a.onhashchange=bY;x.Sink(function(bZ){var b0,b1;b0=bh.MakeHash((b1=bT.Ser(bZ),bh.FromList(b1[0],b1[1])));!bh.SameHash(a.location.hash,b0)?a.location.replace("#"+b0):void 0;},bU.get_View());return bU;};bj.Install=function(bT){return bi.InstallMap(bT);};bj.Create=function(bT,bU){function bV(bW){return bW[0];}return{Des:function(bW){return bU(bV(bW));},Ser:function(bW){return[bT(bW),new bF.New([])];}};};bj.CreateWithQuery=function(bT,bU){return{Des:bU,Ser:bT};};bl.New=function(bT,bU){return{Active:bT,PosV:bU};};bm.New=function(bT,bU,bV,bW){return{Active:bT,Left:bU,Middle:bV,Right:bW};};bn.get_MousePressed=function(){bk.ActivateButtonListener();return x.Apply(x.Apply(x.Apply(x.Const(bA.Curried3(function(bT,bU,bV){return bT||bU||bV;})),bk.MouseBtnSt$1().Left.get_View()),bk.MouseBtnSt$1().Middle.get_View()),bk.MouseBtnSt$1().Right.get_View());};bn.get_RightPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Right.get_View();};bn.get_MiddlePressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Middle.get_View();};bn.get_LeftPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Left.get_View();};bn.get_Position=function(){!bk.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bT){w.Set(bk.MousePosSt$1().PosV,[bT.clientX,bT.clientY]);},false),bk.MousePosSt$1().Active=true):void 0;return bk.MousePosSt$1().PosV.get_View();};bo.New=function(bT,bU,bV){return{KeysPressed:bT,KeyListenerActive:bU,LastPressed:bV};};bp.IsPressed=function(bT){function bU(bV){return bV===bT;}bk.ActivateKeyListener();return x.Map(function(bV){return br.exists(bU,bV);},bk.KeyListenerState().KeysPressed.get_View());};bp.get_LastPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().LastPressed.get_View();};bp.get_KeysPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().KeysPressed.get_View();};bk.ActivateKeyListener=function(){bq.$cctor();return bq.ActivateKeyListener;};bk.KeyListenerState=function(){bq.$cctor();return bq.KeyListenerState;};bk.ActivateButtonListener=function(){bq.$cctor();return bq.ActivateButtonListener;};bk.MouseBtnSt$1=function(){bq.$cctor();return bq.MouseBtnSt;};bk.MousePosSt$1=function(){bq.$cctor();return bq.MousePosSt;};bq.$cctor=function(){bq.$cctor=a.ignore;function bT(bU,bV){var bW;bW=bU.button;return bW===0?w.Set(bk.MouseBtnSt$1().Left,bV):bW===1?w.Set(bk.MouseBtnSt$1().Middle,bV):bW===2?w.Set(bk.MouseBtnSt$1().Right,bV):null;}bq.MousePosSt=bl.New(false,w.Create$1([0,0]));bq.MouseBtnSt=bm.New(false,w.Create$1(false),w.Create$1(false),w.Create$1(false));bq.ActivateButtonListener=!bk.MouseBtnSt$1().Active?(bk.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bU){return bT(bU,true);},false),a.document.addEventListener("mouseup",function(bU){return bT(bU,false);},false)):null;bq.KeyListenerState=bo.New(w.Create$1(br.T.Empty),false,w.Create$1(-1));bq.ActivateKeyListener=!bk.KeyListenerState().KeyListenerActive?(bN(a.document).keydown(function(bU){var bV,bW;bV=bU.which;w.Set(bk.KeyListenerState().LastPressed,bV);bW=bk.KeyListenerState().KeysPressed.Get();return!br.exists(function(bX){return bX===bV;},bW)?bk.KeyListenerState().KeysPressed.Set(br.append(bW,br.ofArray([bV]))):null;}),void bN(a.document).keyup(function(bU){var bV;function bW(bX){return bX!==bV;}bV=bU.which;return w.Update(bk.KeyListenerState().KeysPressed,function(bX){return br.filter(bW,bX);});})):null;};}());
